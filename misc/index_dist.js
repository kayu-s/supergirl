if(!formula&&typeof(require)==="function"){var formula=require("@jspreadsheet/formula")}if(!jSuites&&typeof(require)==="function"){var jSuites=require("jsuites")}(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):b.jspreadsheet=b.jexcel=a()}(this,(function(){var Version=function(){var info={title:"Jspreadsheet",version:"4.9.5",type:"CE",host:"https://bossanova.uk/jspreadsheet",license:"MIT",print:function(){return[this.title+" "+this.type+" "+this.version,this.host,this.license].join("\r\n")}};return function(){return info}}();var isFormula=function(value){var v=(""+value)[0];return v=="="||v=="#"?true:false};var getMask=function(o){if(o.format||o.mask||o.locale){var opt={};if(o.mask){opt.mask=o.mask}else{if(o.format){opt.mask=o.format}else{opt.locale=o.locale;opt.options=o.options}}if(o.decimal){if(!opt.options){opt.options={}}opt.options={decimal:o.decimal}}return opt}return null};var jexcel=(function(el,options){var obj={};obj.options={};if(!(el instanceof Element||el instanceof HTMLDocument)){console.error("Jspreadsheet: el is not a valid DOM element");return false}else{if(el.tagName=="TABLE"){if(options=jexcel.createFromTable(el,options)){var div=document.createElement("div");el.parentNode.insertBefore(div,el);el.remove();el=div}else{console.error("Jspreadsheet: el is not a valid DOM element");return false}}}var defaults={url:null,method:"GET",requestVariables:null,data:null,sorting:null,copyCompatibility:false,root:null,rows:[],columns:[],colHeaders:[],colWidths:[],colAlignments:[],nestedHeaders:null,defaultColWidth:50,defaultColAlign:"center",defaultRowHeight:null,minSpareRows:0,minSpareCols:0,minDimensions:[0,0],allowExport:true,includeHeadersOnDownload:false,includeHeadersOnCopy:false,columnSorting:true,columnDrag:false,columnResize:true,rowResize:false,rowDrag:true,editable:true,allowInsertRow:true,allowManualInsertRow:true,allowInsertColumn:true,allowManualInsertColumn:true,allowDeleteRow:true,allowDeletingAllRows:false,allowDeleteColumn:true,allowRenameColumn:true,allowComments:false,wordWrap:false,imageOptions:null,csv:null,csvFileName:"jspreadsheet",csvHeaders:true,csvDelimiter:",",parseTableFirstRowAsHeader:false,parseTableAutoCellType:false,selectionCopy:true,mergeCells:{},toolbar:null,search:false,pagination:false,paginationOptions:null,fullscreen:false,lazyLoading:false,loadingSpin:false,tableOverflow:false,tableHeight:"300px",tableWidth:null,textOverflow:false,meta:null,style:null,classes:null,parseFormulas:true,autoIncrement:true,autoCasting:true,secureFormulas:true,stripHTML:true,stripHTMLOnCopy:false,filters:false,footers:null,onundo:null,onredo:null,onload:null,onchange:null,oncomments:null,onbeforechange:null,onafterchanges:null,onbeforeinsertrow:null,oninsertrow:null,onbeforeinsertcolumn:null,oninsertcolumn:null,onbeforedeleterow:null,ondeleterow:null,onbeforedeletecolumn:null,ondeletecolumn:null,onmoverow:null,onmovecolumn:null,onresizerow:null,onresizecolumn:null,onsort:null,onselection:null,oncopy:null,onpaste:null,onbeforepaste:null,onmerge:null,onfocus:null,onblur:null,onchangeheader:null,oncreateeditor:null,oneditionstart:null,oneditionend:null,onchangestyle:null,onchangemeta:null,onchangepage:null,onbeforesave:null,onsave:null,onevent:null,persistance:false,updateTable:null,detachForUpdates:false,freezeColumns:null,text:{noRecordsFound:"No records found",showingPage:"Showing page {0} of {1} entries",show:"Show ",search:"Search",entries:" entries",columnName:"Column name",insertANewColumnBefore:"Insert a new column before",insertANewColumnAfter:"Insert a new column after",deleteSelectedColumns:"Delete selected columns",renameThisColumn:"Rename this column",orderAscending:"Order ascending",orderDescending:"Order descending",insertANewRowBefore:"Insert a new row before",insertANewRowAfter:"Insert a new row after",deleteSelectedRows:"Delete selected rows",editComments:"Edit comments",addComments:"Add comments",comments:"Comments",clearComments:"Clear comments",copy:"Copy...",paste:"Paste...",saveAs:"Save as...",about:"About",areYouSureToDeleteTheSelectedRows:"Are you sure to delete the selected rows?",areYouSureToDeleteTheSelectedColumns:"Are you sure to delete the selected columns?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"This action will destroy any existing merged cells. Are you sure?",thisActionWillClearYourSearchResultsAreYouSure:"This action will clear your search results. Are you sure?",thereIsAConflictWithAnotherMergedCell:"There is a conflict with another merged cell",invalidMergeProperties:"Invalid merged properties",cellAlreadyMerged:"Cell already merged",noCellsSelected:"No cells selected"},about:true};for(var property in defaults){if(options&&options.hasOwnProperty(property)){if(property==="text"){obj.options[property]=defaults[property];for(var textKey in options[property]){if(options[property].hasOwnProperty(textKey)){obj.options[property][textKey]=options[property][textKey]}}}else{obj.options[property]=options[property]}}else{obj.options[property]=defaults[property]}}obj.el=el;obj.corner=null;obj.contextMenu=null;obj.textarea=null;obj.ads=null;obj.content=null;obj.table=null;obj.thead=null;obj.tbody=null;obj.rows=[];obj.results=null;obj.searchInput=null;obj.toolbar=null;obj.pagination=null;obj.pageNumber=null;obj.headerContainer=null;obj.colgroupContainer=null;obj.headers=[];obj.records=[];obj.history=[];obj.formula=[];obj.colgroup=[];obj.selection=[];obj.highlighted=[];obj.selectedCell=null;obj.selectedContainer=null;obj.style=[];obj.data=null;obj.filter=null;obj.filters=[];obj.cursor=null;obj.historyIndex=-1;obj.ignoreEvents=false;obj.ignoreHistory=false;obj.edition=null;obj.hashString=null;obj.resizing=null;obj.dragging=null;if(obj.options.lazyLoading==true&&(obj.options.tableOverflow==false&&obj.options.fullscreen==false)){console.error("Jspreadsheet: The lazyloading only works when tableOverflow = yes or fullscreen = yes");obj.options.lazyLoading=false}obj.fullscreen=function(activate){if(activate==null){activate=!obj.options.fullscreen}if(obj.options.fullscreen!=activate){obj.options.fullscreen=activate;if(activate==true){el.classList.add("fullscreen")}else{el.classList.remove("fullscreen")}}};obj.dispatch=function(event){if(!obj.ignoreEvents){if(typeof(obj.options.onevent)=="function"){var ret=obj.options.onevent.apply(this,arguments)}if(typeof(obj.options[event])=="function"){var ret=obj.options[event].apply(this,Array.prototype.slice.call(arguments,1))}}if(event=="onafterchanges"&&obj.options.persistance){var url=obj.options.persistance==true?obj.options.url:obj.options.persistance;var data=obj.prepareJson(arguments[2]);obj.save(url,data)}return ret};obj.prepareTable=function(){var results=[];var size=obj.options.columns.length;if(obj.options.data&&typeof(obj.options.data[0])!=="undefined"){var keys=Object.keys(obj.options.data[0]);if(keys.length>size){size=keys.length}}if(obj.options.minDimensions[0]>size){size=obj.options.minDimensions[0]}var multiple=[];for(var i=0;i<size;i++){if(!obj.options.colHeaders[i]){obj.options.colHeaders[i]=""}if(!obj.options.colWidths[i]){obj.options.colWidths[i]=obj.options.defaultColWidth}if(!obj.options.colAlignments[i]){obj.options.colAlignments[i]=obj.options.defaultColAlign}if(!obj.options.columns[i]){obj.options.columns[i]={type:"text"}}else{if(!obj.options.columns[i].type){obj.options.columns[i].type="text"}}if(!obj.options.columns[i].name){obj.options.columns[i].name=keys&&keys[i]?keys[i]:i}if(!obj.options.columns[i].source){obj.options.columns[i].source=[]}if(!obj.options.columns[i].options){obj.options.columns[i].options=[]}if(!obj.options.columns[i].editor){obj.options.columns[i].editor=null}if(!obj.options.columns[i].allowEmpty){obj.options.columns[i].allowEmpty=false}if(!obj.options.columns[i].title){obj.options.columns[i].title=obj.options.colHeaders[i]?obj.options.colHeaders[i]:""}if(!obj.options.columns[i].width){obj.options.columns[i].width=obj.options.colWidths[i]?obj.options.colWidths[i]:obj.options.defaultColWidth}if(!obj.options.columns[i].align){obj.options.columns[i].align=obj.options.colAlignments[i]?obj.options.colAlignments[i]:"center"}if(obj.options.columns[i].type=="autocomplete"||obj.options.columns[i].type=="dropdown"){if(obj.options.columns[i].url){multiple.push({url:obj.options.columns[i].url,index:i,method:"GET",dataType:"json",success:function(data){var source=[];for(var i=0;i<data.length;i++){obj.options.columns[this.index].source.push(data[i])}}})}}else{if(obj.options.columns[i].type=="calendar"){if(!obj.options.columns[i].options.format){obj.options.columns[i].options.format="DD/MM/YYYY"}}}}if(!multiple.length){obj.createTable()}else{jSuites.ajax(multiple,function(){obj.createTable()})}};obj.createTable=function(){obj.table=document.createElement("table");obj.thead=document.createElement("thead");obj.tbody=document.createElement("tbody");obj.headers=[];obj.colgroup=[];obj.content=document.createElement("div");obj.content.classList.add("jexcel_content");obj.content.onscroll=function(e){obj.scrollControls(e)};obj.content.onwheel=function(e){obj.wheelControls(e)};obj.toolbar=document.createElement("div");obj.toolbar.classList.add("jexcel_toolbar");var searchContainer=document.createElement("div");var searchText=document.createTextNode((obj.options.text.search)+": ");obj.searchInput=document.createElement("input");obj.searchInput.classList.add("jexcel_search");searchContainer.appendChild(searchText);searchContainer.appendChild(obj.searchInput);obj.searchInput.onfocus=function(){obj.resetSelection()};var paginationUpdateContainer=document.createElement("div");if(obj.options.pagination>0&&obj.options.paginationOptions&&obj.options.paginationOptions.length>0){obj.paginationDropdown=document.createElement("select");obj.paginationDropdown.classList.add("jexcel_pagination_dropdown");obj.paginationDropdown.onchange=function(){obj.options.pagination=parseInt(this.value);obj.page(0)};for(var i=0;i<obj.options.paginationOptions.length;i++){var temp=document.createElement("option");temp.value=obj.options.paginationOptions[i];temp.innerHTML=obj.options.paginationOptions[i];obj.paginationDropdown.appendChild(temp)}obj.paginationDropdown.value=obj.options.pagination;paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.show));paginationUpdateContainer.appendChild(obj.paginationDropdown);paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.entries))}var filter=document.createElement("div");filter.classList.add("jexcel_filter");filter.appendChild(paginationUpdateContainer);filter.appendChild(searchContainer);obj.colgroupContainer=document.createElement("colgroup");var tempCol=document.createElement("col");tempCol.setAttribute("width","50");obj.colgroupContainer.appendChild(tempCol);if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]){for(var j=0;j<obj.options.nestedHeaders.length;j++){obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[j]))}}else{obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders))}}obj.headerContainer=document.createElement("tr");var tempCol=document.createElement("td");tempCol.classList.add("jexcel_selectall");obj.headerContainer.appendChild(tempCol);for(var i=0;i<obj.options.columns.length;i++){obj.createCellHeader(i);obj.headerContainer.appendChild(obj.headers[i]);obj.colgroupContainer.appendChild(obj.colgroup[i])}obj.thead.appendChild(obj.headerContainer);if(obj.options.filters==true){obj.filter=document.createElement("tr");var td=document.createElement("td");obj.filter.appendChild(td);for(var i=0;i<obj.options.columns.length;i++){var td=document.createElement("td");td.innerHTML="&nbsp;";td.setAttribute("data-x",i);td.className="jexcel_column_filter";if(obj.options.columns[i].type=="hidden"){td.style.display="none"}obj.filter.appendChild(td)}obj.thead.appendChild(obj.filter)}obj.table=document.createElement("table");obj.table.classList.add("jexcel");obj.table.setAttribute("cellpadding","0");obj.table.setAttribute("cellspacing","0");obj.table.setAttribute("unselectable","yes");obj.table.appendChild(obj.colgroupContainer);obj.table.appendChild(obj.thead);obj.table.appendChild(obj.tbody);if(!obj.options.textOverflow){obj.table.classList.add("jexcel_overflow")}obj.corner=document.createElement("div");obj.corner.className="jexcel_corner";obj.corner.setAttribute("unselectable","on");obj.corner.setAttribute("onselectstart","return false");if(obj.options.selectionCopy==false){obj.corner.style.display="none"}obj.textarea=document.createElement("textarea");obj.textarea.className="jexcel_textarea";obj.textarea.id="jexcel_textarea";obj.textarea.tabIndex="-1";obj.contextMenu=document.createElement("div");obj.contextMenu.className="jexcel_contextmenu";jSuites.contextmenu(obj.contextMenu,{onclick:function(){obj.contextMenu.contextmenu.close(false)}});var ads=document.createElement("a");ads.setAttribute("href","https://bossanova.uk/jspreadsheet/");obj.ads=document.createElement("div");obj.ads.className="jexcel_about";try{if(typeof(sessionStorage)!=="undefined"&&!sessionStorage.getItem("jexcel")){sessionStorage.setItem("jexcel",true);var img=document.createElement("img");img.src="//bossanova.uk/jspreadsheet/logo.png";ads.appendChild(img)}}catch(exception){}var span=document.createElement("span");span.innerHTML="Jspreadsheet CE";ads.appendChild(span);obj.ads.appendChild(ads);var container=document.createElement("div");container.classList.add("jexcel_table");obj.pagination=document.createElement("div");obj.pagination.classList.add("jexcel_pagination");var paginationInfo=document.createElement("div");var paginationPages=document.createElement("div");obj.pagination.appendChild(paginationInfo);obj.pagination.appendChild(paginationPages);if(!obj.options.pagination){obj.pagination.style.display="none"}if(obj.options.search==true){el.appendChild(filter)}obj.content.appendChild(obj.table);obj.content.appendChild(obj.corner);obj.content.appendChild(obj.textarea);el.appendChild(obj.toolbar);el.appendChild(obj.content);el.appendChild(obj.pagination);el.appendChild(obj.contextMenu);el.appendChild(obj.ads);el.classList.add("jexcel_container");if(obj.options.toolbar&&obj.options.toolbar.length){obj.createToolbar()}if(obj.options.fullscreen==true){el.classList.add("fullscreen")}else{if(obj.options.tableOverflow==true){if(obj.options.tableHeight){obj.content.style["overflow-y"]="auto";obj.content.style["box-shadow"]="rgb(221 221 221) 2px 2px 5px 0.1px";obj.content.style.maxHeight=obj.options.tableHeight}if(obj.options.tableWidth){obj.content.style["overflow-x"]="auto";obj.content.style.width=obj.options.tableWidth}}}if(obj.options.tableOverflow!=true&&obj.options.toolbar){el.classList.add("with-toolbar")}if(obj.options.columnDrag==true){obj.thead.classList.add("draggable")}if(obj.options.columnResize==true){obj.thead.classList.add("resizable")}if(obj.options.rowDrag==true){obj.tbody.classList.add("draggable")}if(obj.options.rowResize==true){obj.tbody.classList.add("resizable")}obj.setData();if(obj.options.style){obj.setStyle(obj.options.style,null,null,1,1)}if(obj.options.classes){var k=Object.keys(obj.options.classes);for(var i=0;i<k.length;i++){var cell=jexcel.getIdFromColumnName(k[i],true);obj.records[cell[1]][cell[0]].classList.add(obj.options.classes[k[i]])}}};obj.refresh=function(){if(obj.options.url){if(obj.options.loadingSpin==true){jSuites.loading.show()}jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(result){obj.options.data=(result.data)?result.data:result;obj.setData();if(obj.options.loadingSpin==true){jSuites.loading.hide()}}})}else{obj.setData()}};obj.setData=function(data){if(data){if(typeof(data)=="string"){data=JSON.parse(data)}obj.options.data=data}if(!obj.options.data){obj.options.data=[]}if(obj.options.data&&obj.options.data[0]){if(!Array.isArray(obj.options.data[0])){var data=[];for(var j=0;j<obj.options.data.length;j++){var row=[];for(var i=0;i<obj.options.columns.length;i++){row[i]=obj.options.data[j][obj.options.columns[i].name]}data.push(row)}obj.options.data=data}}var j=0;var i=0;var size_i=obj.options.columns.length;var size_j=obj.options.data.length;var min_i=obj.options.minDimensions[0];var min_j=obj.options.minDimensions[1];var max_i=min_i>size_i?min_i:size_i;var max_j=min_j>size_j?min_j:size_j;for(j=0;j<max_j;j++){for(i=0;i<max_i;i++){if(obj.options.data[j]==undefined){obj.options.data[j]=[]}if(obj.options.data[j][i]==undefined){obj.options.data[j][i]=""}}}obj.rows=[];obj.results=null;obj.records=[];obj.history=[];obj.historyIndex=-1;obj.tbody.innerHTML="";if(obj.options.lazyLoading==true){var startNumber=0;var finalNumber=obj.options.data.length<100?obj.options.data.length:100;if(obj.options.pagination){obj.options.pagination=false;console.error("Jspreadsheet: Pagination will be disable due the lazyLoading")}}else{if(obj.options.pagination){if(!obj.pageNumber){obj.pageNumber=0}var quantityPerPage=obj.options.pagination;startNumber=(obj.options.pagination*obj.pageNumber);finalNumber=(obj.options.pagination*obj.pageNumber)+obj.options.pagination;if(obj.options.data.length<finalNumber){finalNumber=obj.options.data.length}}else{var startNumber=0;var finalNumber=obj.options.data.length}}for(j=0;j<obj.options.data.length;j++){var tr=obj.createRow(j,obj.options.data[j]);if(j>=startNumber&&j<finalNumber){obj.tbody.appendChild(tr)}}if(obj.options.lazyLoading==true){}else{if(obj.options.pagination){obj.updatePagination()}}if(obj.options.mergeCells){var keys=Object.keys(obj.options.mergeCells);for(var i=0;i<keys.length;i++){var num=obj.options.mergeCells[keys[i]];obj.setMerge(keys[i],num[0],num[1],1)}}obj.updateTable();obj.dispatch("onload",el,obj)};obj.getData=function(highlighted,dataOnly){var dataset=[];var px=0;var py=0;var dataType=dataOnly==true||obj.options.copyCompatibility==false?true:false;var x=obj.options.columns.length;var y=obj.options.data.length;for(var j=0;j<y;j++){px=0;for(var i=0;i<x;i++){if(!highlighted||obj.records[j][i].classList.contains("highlight")){if(!dataset[py]){dataset[py]=[]}if(!dataType){dataset[py][px]=obj.records[j][i].innerHTML}else{dataset[py][px]=obj.options.data[j][i]}px++}}if(px>0){py++}}return dataset};obj.getJsonRow=function(rowNumber){var rowData=obj.options.data[rowNumber];var x=obj.options.columns.length;var row={};for(var i=0;i<x;i++){if(!obj.options.columns[i].name){obj.options.columns[i].name=i}row[obj.options.columns[i].name]=rowData[i]}return row};obj.getJson=function(highlighted){var data=[];var x=obj.options.columns.length;var y=obj.options.data.length;for(var j=0;j<y;j++){var row=null;for(var i=0;i<x;i++){if(!highlighted||obj.records[j][i].classList.contains("highlight")){if(row==null){row={}}if(!obj.options.columns[i].name){obj.options.columns[i].name=i}row[obj.options.columns[i].name]=obj.options.data[j][i]}}if(row!=null){data.push(row)}}return data};obj.prepareJson=function(data){var rows=[];for(var i=0;i<data.length;i++){var x=data[i].x;var y=data[i].y;var k=obj.options.columns[x].name?obj.options.columns[x].name:x;if(!rows[y]){rows[y]={row:y,data:{}}}rows[y].data[k]=data[i].newValue}return rows.filter(function(el){return el!=null})};obj.save=function(url,data){var ret=obj.dispatch("onbeforesave",el,obj,data);if(ret){var data=ret}else{if(ret===false){return false}}jSuites.ajax({url:url,method:"POST",dataType:"json",data:{data:JSON.stringify(data)},success:function(result){obj.dispatch("onsave",el,obj,data)}})};obj.getRowData=function(rowNumber){return obj.options.data[rowNumber]};obj.setRowData=function(rowNumber,data){for(var i=0;i<obj.headers.length;i++){var columnName=jexcel.getColumnNameFromId([i,rowNumber]);if(data[i]!=null){obj.setValue(columnName,data[i])}}};obj.getColumnData=function(columnNumber){var dataset=[];for(var j=0;j<obj.options.data.length;j++){dataset.push(obj.options.data[j][columnNumber])}return dataset};obj.setColumnData=function(colNumber,data){for(var j=0;j<obj.rows.length;j++){var columnName=jexcel.getColumnNameFromId([colNumber,j]);if(data[j]!=null){obj.setValue(columnName,data[j])}}};obj.createRow=function(j,data){if(!obj.records[j]){obj.records[j]=[]}if(!data){var data=obj.options.data[j]}obj.rows[j]=document.createElement("tr");obj.rows[j].setAttribute("data-y",j);var index=null;if(obj.options.defaultRowHeight){obj.rows[j].style.height=obj.options.defaultRowHeight+"px"}if(obj.options.rows[j]){if(obj.options.rows[j].height){obj.rows[j].style.height=obj.options.rows[j].height}if(obj.options.rows[j].title){index=obj.options.rows[j].title}}if(!index){index=parseInt(j+1)}var td=document.createElement("td");td.innerHTML=index;td.setAttribute("data-y",j);td.className="jexcel_row";obj.rows[j].appendChild(td);for(var i=0;i<obj.options.columns.length;i++){obj.records[j][i]=obj.createCell(i,j,data[i]);obj.rows[j].appendChild(obj.records[j][i])}return obj.rows[j]};obj.parseValue=function(i,j,value,cell){if((""+value).substr(0,1)=="="&&obj.options.parseFormulas==true){value=obj.executeFormula(value,i,j)}var options=obj.options.columns[i];if(options&&!isFormula(value)){var opt=null;if(opt=getMask(options)){if(value&&value==Number(value)){value=Number(value)}var masked=jSuites.mask.render(value,opt,true);if(cell){if(opt.mask){var t=opt.mask.split(";");if(t[1]){var t1=t[1].match(new RegExp("\\[Red\\]","gi"));if(t1){if(value<0){cell.classList.add("red")}else{cell.classList.remove("red")}}var t2=t[1].match(new RegExp("\\(","gi"));if(t2){if(value<0){masked="("+masked+")"}}}}}if(masked){value=masked}}}return value};obj.createCell=function(i,j,value){var td=document.createElement("td");td.setAttribute("data-x",i);td.setAttribute("data-y",j);if((""+value).substr(0,1)=="="&&obj.options.secureFormulas==true){var val=secureFormula(value);if(val!=value){value=val}}if(obj.options.columns[i].editor){if(obj.options.stripHTML===false||obj.options.columns[i].stripHTML===false){td.innerHTML=value}else{td.innerText=value}if(typeof(obj.options.columns[i].editor.createCell)=="function"){td=obj.options.columns[i].editor.createCell(td)}}else{if(obj.options.columns[i].type=="hidden"){td.style.display="none";td.innerText=value}else{if(obj.options.columns[i].type=="checkbox"||obj.options.columns[i].type=="radio"){var element=document.createElement("input");element.type=obj.options.columns[i].type;element.name="c"+i;element.checked=(value==1||value==true||value=="true")?true:false;element.onclick=function(){obj.setValue(td,this.checked)};if(obj.options.columns[i].readOnly==true||obj.options.editable==false){element.setAttribute("disabled","disabled")}td.appendChild(element);obj.options.data[j][i]=element.checked}else{if(obj.options.columns[i].type=="calendar"){var formatted=jSuites.calendar.extractDateFromString(value,obj.options.columns[i].options.format);td.innerText=jSuites.calendar.getDateString(formatted?formatted:value,obj.options.columns[i].options.format)}else{if(obj.options.columns[i].type=="dropdown"||obj.options.columns[i].type=="autocomplete"){td.classList.add("jexcel_dropdown");td.innerText=obj.getDropDownValue(i,value)}else{if(obj.options.columns[i].type=="color"){if(obj.options.columns[i].render=="square"){var color=document.createElement("div");color.className="color";color.style.backgroundColor=value;td.appendChild(color)}else{td.style.color=value;td.innerText=value}}else{if(obj.options.columns[i].type=="image"){if(value&&value.substr(0,10)=="data:image"){var img=document.createElement("img");img.src=value;td.appendChild(img)}}else{if(obj.options.columns[i].type=="html"){td.innerHTML=stripScript(obj.parseValue(i,j,value,td))}else{if(obj.options.stripHTML===false||obj.options.columns[i].stripHTML===false){td.innerHTML=stripScript(obj.parseValue(i,j,value,td))}else{td.innerText=obj.parseValue(i,j,value,td)}}}}}}}}}if(obj.options.columns[i].readOnly==true){td.className="readonly"}var colAlign=obj.options.columns[i].align?obj.options.columns[i].align:"center";td.style.textAlign=colAlign;if(obj.options.columns[i].wordWrap!=false&&(obj.options.wordWrap==true||obj.options.columns[i].wordWrap==true||td.innerHTML.length>200)){td.style.whiteSpace="pre-wrap"}if(i>0){if(this.options.textOverflow==true){if(value||td.innerHTML){obj.records[j][i-1].style.overflow="hidden"}else{if(i==obj.options.columns.length-1){td.style.overflow="hidden"}}}}return td};obj.createCellHeader=function(colNumber){var colWidth=obj.options.columns[colNumber].width?obj.options.columns[colNumber].width:obj.options.defaultColWidth;var colAlign=obj.options.columns[colNumber].align?obj.options.columns[colNumber].align:obj.options.defaultColAlign;obj.headers[colNumber]=document.createElement("td");if(obj.options.stripHTML){obj.headers[colNumber].innerText=obj.options.columns[colNumber].title?obj.options.columns[colNumber].title:jexcel.getColumnName(colNumber)}else{obj.headers[colNumber].innerHTML=obj.options.columns[colNumber].title?obj.options.columns[colNumber].title:jexcel.getColumnName(colNumber)}obj.headers[colNumber].setAttribute("data-x",colNumber);obj.headers[colNumber].style.textAlign=colAlign;if(obj.options.columns[colNumber].title){obj.headers[colNumber].setAttribute("title",obj.options.columns[colNumber].title)}if(obj.options.columns[colNumber].id){obj.headers[colNumber].setAttribute("id",obj.options.columns[colNumber].id)}obj.colgroup[colNumber]=document.createElement("col");obj.colgroup[colNumber].setAttribute("width",colWidth);if(obj.options.columns[colNumber].type=="hidden"){obj.headers[colNumber].style.display="none";obj.colgroup[colNumber].style.display="none"}};obj.updateNestedHeader=function(x,y,title){if(obj.options.nestedHeaders[y][x].title){obj.options.nestedHeaders[y][x].title=title;obj.options.nestedHeaders[y].element.children[x+1].innerText=title}};obj.createNestedHeader=function(nestedInformation){var tr=document.createElement("tr");tr.classList.add("jexcel_nested");var td=document.createElement("td");tr.appendChild(td);nestedInformation.element=tr;var headerIndex=0;for(var i=0;i<nestedInformation.length;i++){if(!nestedInformation[i].colspan){nestedInformation[i].colspan=1}if(!nestedInformation[i].align){nestedInformation[i].align="center"}if(!nestedInformation[i].title){nestedInformation[i].title=""}var numberOfColumns=nestedInformation[i].colspan;var column=[];for(var x=0;x<numberOfColumns;x++){if(obj.options.columns[headerIndex]&&obj.options.columns[headerIndex].type=="hidden"){numberOfColumns++}column.push(headerIndex);headerIndex++}var td=document.createElement("td");td.setAttribute("data-column",column.join(","));td.setAttribute("colspan",nestedInformation[i].colspan);td.setAttribute("align",nestedInformation[i].align);td.innerText=nestedInformation[i].title;tr.appendChild(td)}return tr};obj.createToolbar=function(toolbar){if(toolbar){obj.options.toolbar=toolbar}else{var toolbar=obj.options.toolbar}for(var i=0;i<toolbar.length;i++){if(toolbar[i].type=="i"){var toolbarItem=document.createElement("i");toolbarItem.classList.add("jexcel_toolbar_item");toolbarItem.classList.add("material-icons");toolbarItem.setAttribute("data-k",toolbar[i].k);toolbarItem.setAttribute("data-v",toolbar[i].v);toolbarItem.setAttribute("id",toolbar[i].id);if(toolbar[i].tooltip){toolbarItem.setAttribute("title",toolbar[i].tooltip)}if(toolbar[i].onclick&&typeof(toolbar[i].onclick)){toolbarItem.onclick=(function(a){var b=a;return function(){toolbar[b].onclick(el,obj,this)}})(i)}else{toolbarItem.onclick=function(){var k=this.getAttribute("data-k");var v=this.getAttribute("data-v");obj.setStyle(obj.highlighted,k,v)}}toolbarItem.innerText=toolbar[i].content;obj.toolbar.appendChild(toolbarItem)}else{if(toolbar[i].type=="select"){var toolbarItem=document.createElement("select");toolbarItem.classList.add("jexcel_toolbar_item");toolbarItem.setAttribute("data-k",toolbar[i].k);if(toolbar[i].tooltip){toolbarItem.setAttribute("title",toolbar[i].tooltip)}if(toolbar[i].onchange&&typeof(toolbar[i].onchange)){toolbarItem.onchange=toolbar[i].onchange}else{toolbarItem.onchange=function(){var k=this.getAttribute("data-k");obj.setStyle(obj.highlighted,k,this.value)}}for(var j=0;j<toolbar[i].v.length;j++){var toolbarDropdownOption=document.createElement("option");toolbarDropdownOption.value=toolbar[i].v[j];toolbarDropdownOption.innerText=toolbar[i].v[j];toolbarItem.appendChild(toolbarDropdownOption)}obj.toolbar.appendChild(toolbarItem)}else{if(toolbar[i].type=="color"){var toolbarItem=document.createElement("i");toolbarItem.classList.add("jexcel_toolbar_item");toolbarItem.classList.add("material-icons");toolbarItem.setAttribute("data-k",toolbar[i].k);toolbarItem.setAttribute("data-v","");if(toolbar[i].tooltip){toolbarItem.setAttribute("title",toolbar[i].tooltip)}obj.toolbar.appendChild(toolbarItem);toolbarItem.innerText=toolbar[i].content;jSuites.color(toolbarItem,{onchange:function(o,v){var k=o.getAttribute("data-k");obj.setStyle(obj.highlighted,k,v)}})}}}}};obj.setMerge=function(cellName,colspan,rowspan,ignoreHistoryAndEvents){var test=false;if(!cellName){if(!obj.highlighted.length){alert(obj.options.text.noCellsSelected);return null}else{var x1=parseInt(obj.highlighted[0].getAttribute("data-x"));var y1=parseInt(obj.highlighted[0].getAttribute("data-y"));var x2=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-x"));var y2=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-y"));var cellName=jexcel.getColumnNameFromId([x1,y1]);var colspan=(x2-x1)+1;var rowspan=(y2-y1)+1}}var cell=jexcel.getIdFromColumnName(cellName,true);if(obj.options.mergeCells[cellName]){if(obj.records[cell[1]][cell[0]].getAttribute("data-merged")){test=obj.options.text.cellAlreadyMerged}}else{if((!colspan||colspan<2)&&(!rowspan||rowspan<2)){test=obj.options.text.invalidMergeProperties}else{var cells=[];for(var j=cell[1];j<cell[1]+rowspan;j++){for(var i=cell[0];i<cell[0]+colspan;i++){var columnName=jexcel.getColumnNameFromId([i,j]);if(obj.records[j][i].getAttribute("data-merged")){test=obj.options.text.thereIsAConflictWithAnotherMergedCell}}}}}if(test){alert(test)}else{if(colspan>1){obj.records[cell[1]][cell[0]].setAttribute("colspan",colspan)}else{colspan=1}if(rowspan>1){obj.records[cell[1]][cell[0]].setAttribute("rowspan",rowspan)}else{rowspan=1}obj.options.mergeCells[cellName]=[colspan,rowspan,[]];obj.records[cell[1]][cell[0]].setAttribute("data-merged","true");obj.records[cell[1]][cell[0]].style.overflow="hidden";var data=[];for(var y=cell[1];y<cell[1]+rowspan;y++){for(var x=cell[0];x<cell[0]+colspan;x++){if(!(cell[0]==x&&cell[1]==y)){data.push(obj.options.data[y][x]);obj.updateCell(x,y,"",true);obj.options.mergeCells[cellName][2].push(obj.records[y][x]);obj.records[y][x].style.display="none";obj.records[y][x]=obj.records[cell[1]][cell[0]]}}}obj.updateSelection(obj.records[cell[1]][cell[0]]);if(!ignoreHistoryAndEvents){obj.setHistory({action:"setMerge",column:cellName,colspan:colspan,rowspan:rowspan,data:data});obj.dispatch("onmerge",el,cellName,colspan,rowspan)}}};obj.getMerge=function(cellName){var data={};if(cellName){if(obj.options.mergeCells[cellName]){data=[obj.options.mergeCells[cellName][0],obj.options.mergeCells[cellName][1]]}else{data=null}}else{if(obj.options.mergeCells){var mergedCells=obj.options.mergeCells;var keys=Object.keys(obj.options.mergeCells);for(var i=0;i<keys.length;i++){data[keys[i]]=[obj.options.mergeCells[keys[i]][0],obj.options.mergeCells[keys[i]][1]]}}}return data};obj.removeMerge=function(cellName,data,keepOptions){if(obj.options.mergeCells[cellName]){var cell=jexcel.getIdFromColumnName(cellName,true);obj.records[cell[1]][cell[0]].removeAttribute("colspan");obj.records[cell[1]][cell[0]].removeAttribute("rowspan");obj.records[cell[1]][cell[0]].removeAttribute("data-merged");var info=obj.options.mergeCells[cellName];var index=0;for(var j=0;j<info[1];j++){for(var i=0;i<info[0];i++){if(j>0||i>0){obj.records[cell[1]+j][cell[0]+i]=info[2][index];obj.records[cell[1]+j][cell[0]+i].style.display="";if(data&&data[index]){obj.updateCell(cell[0]+i,cell[1]+j,data[index])}index++}}}obj.updateSelection(obj.records[cell[1]][cell[0]],obj.records[cell[1]+j-1][cell[0]+i-1]);if(!keepOptions){delete (obj.options.mergeCells[cellName])}}};obj.destroyMerged=function(keepOptions){if(obj.options.mergeCells){var mergedCells=obj.options.mergeCells;var keys=Object.keys(obj.options.mergeCells);for(var i=0;i<keys.length;i++){obj.removeMerge(keys[i],null,keepOptions)}}};obj.isColMerged=function(x,insertBefore){var cols=[];if(obj.options.mergeCells){var keys=Object.keys(obj.options.mergeCells);for(var i=0;i<keys.length;i++){var info=jexcel.getIdFromColumnName(keys[i],true);var colspan=obj.options.mergeCells[keys[i]][0];var x1=info[0];var x2=info[0]+(colspan>1?colspan-1:0);if(insertBefore==null){if((x1<=x&&x2>=x)){cols.push(keys[i])}}else{if(insertBefore){if((x1<x&&x2>=x)){cols.push(keys[i])}}else{if((x1<=x&&x2>x)){cols.push(keys[i])}}}}}return cols};obj.isRowMerged=function(y,insertBefore){var rows=[];if(obj.options.mergeCells){var keys=Object.keys(obj.options.mergeCells);for(var i=0;i<keys.length;i++){var info=jexcel.getIdFromColumnName(keys[i],true);var rowspan=obj.options.mergeCells[keys[i]][1];var y1=info[1];var y2=info[1]+(rowspan>1?rowspan-1:0);if(insertBefore==null){if((y1<=y&&y2>=y)){rows.push(keys[i])}}else{if(insertBefore){if((y1<y&&y2>=y)){rows.push(keys[i])}}else{if((y1<=y&&y2>y)){rows.push(keys[i])}}}}}return rows};obj.openFilter=function(columnId){if(!obj.options.filters){console.log("Jspreadsheet: filters not enabled.")}else{columnId=parseInt(columnId);obj.resetSelection();var optionsFiltered=[];if(obj.options.columns[columnId].type=="checkbox"){optionsFiltered.push({id:"true",name:"True"});optionsFiltered.push({id:"false",name:"False"})}else{var options=[];var hasBlanks=false;for(var j=0;j<obj.options.data.length;j++){var k=obj.options.data[j][columnId];var v=obj.records[j][columnId].innerHTML;if(k&&v){options[k]=v}else{var hasBlanks=true}}var keys=Object.keys(options);var optionsFiltered=[];for(var j=0;j<keys.length;j++){optionsFiltered.push({id:keys[j],name:options[keys[j]]})}if(hasBlanks){optionsFiltered.push({value:"",id:"",name:"(Blanks)"})}}var div=document.createElement("div");obj.filter.children[columnId+1].innerHTML="";obj.filter.children[columnId+1].appendChild(div);obj.filter.children[columnId+1].style.paddingLeft="0px";obj.filter.children[columnId+1].style.paddingRight="0px";obj.filter.children[columnId+1].style.overflow="initial";var opt={data:optionsFiltered,multiple:true,autocomplete:true,opened:true,value:obj.filters[columnId]!==undefined?obj.filters[columnId]:null,width:"100%",position:(obj.options.tableOverflow==true||obj.options.fullscreen==true)?true:false,onclose:function(o){obj.resetFilters();obj.filters[columnId]=o.dropdown.getValue(true);obj.filter.children[columnId+1].innerHTML=o.dropdown.getText();obj.filter.children[columnId+1].style.paddingLeft="";obj.filter.children[columnId+1].style.paddingRight="";obj.filter.children[columnId+1].style.overflow="";obj.closeFilter(columnId);obj.refreshSelection()}};jSuites.dropdown(div,opt)}};obj.resetFilters=function(){if(obj.options.filters){for(var i=0;i<obj.filter.children.length;i++){obj.filter.children[i].innerHTML="&nbsp;";obj.filters[i]=null}}};obj.closeFilter=function(columnId){if(!columnId){for(var i=0;i<obj.filter.children.length;i++){if(obj.filters[i]){columnId=i}}}var search=function(query,x,y){for(var i=0;i<query.length;i++){if((query[i]==""&&((obj.options.data[y][x]===false)||(""+obj.options.data[y][x])==""))||((query[i]!=""&&((""+obj.options.data[y][x]).search(query[i])>=0||(""+obj.records[y][x].innerHTML).search(query[i])>=0)))){return true}}return false};var query=obj.filters[columnId];obj.results=[];for(var j=0;j<obj.options.data.length;j++){if(search(query,columnId,j)){obj.results.push(j)}}if(!obj.results.length){obj.results=null}obj.updateResult()};obj.openEditor=function(cell,empty,e){var y=cell.getAttribute("data-y");var x=cell.getAttribute("data-x");obj.dispatch("oneditionstart",el,cell,x,y);if(x>0){obj.records[y][x-1].style.overflow="hidden"}var createEditor=function(type){var info=cell.getBoundingClientRect();var editor=document.createElement(type);editor.style.width=(info.width)+"px";editor.style.height=(info.height-2)+"px";editor.style.minHeight=(info.height-2)+"px";cell.classList.add("editor");cell.innerHTML="";cell.appendChild(editor);obj.dispatch("oncreateeditor",el,cell,x,y,editor);return editor};if(cell.classList.contains("readonly")==true){}else{obj.edition=[obj.records[y][x],obj.records[y][x].innerHTML,x,y];if(obj.options.columns[x].editor){obj.options.columns[x].editor.openEditor(cell,el,empty,e)}else{if(obj.options.columns[x].type=="hidden"){}else{if(obj.options.columns[x].type=="checkbox"||obj.options.columns[x].type=="radio"){var value=cell.children[0].checked?false:true;obj.setValue(cell,value);obj.edition=null}else{if(obj.options.columns[x].type=="dropdown"||obj.options.columns[x].type=="autocomplete"){var value=obj.options.data[y][x];if(obj.options.columns[x].multiple&&!Array.isArray(value)){value=value.split(";")}if(typeof(obj.options.columns[x].filter)=="function"){var source=obj.options.columns[x].filter(el,cell,x,y,obj.options.columns[x].source)}else{var source=obj.options.columns[x].source}var data=[];for(var j=0;j<source.length;j++){data.push(source[j])}var editor=createEditor("div");var options={data:data,multiple:obj.options.columns[x].multiple?true:false,autocomplete:obj.options.columns[x].autocomplete||obj.options.columns[x].type=="autocomplete"?true:false,opened:true,value:value,width:"100%",height:editor.style.minHeight,position:(obj.options.tableOverflow==true||obj.options.fullscreen==true)?true:false,onclose:function(){obj.closeEditor(cell,true)}};if(obj.options.columns[x].options&&obj.options.columns[x].options.type){options.type=obj.options.columns[x].options.type}jSuites.dropdown(editor,options)}else{if(obj.options.columns[x].type=="calendar"||obj.options.columns[x].type=="color"){var value=obj.options.data[y][x];var editor=createEditor("input");editor.value=value;if(obj.options.tableOverflow==true||obj.options.fullscreen==true){obj.options.columns[x].options.position=true}obj.options.columns[x].options.value=obj.options.data[y][x];obj.options.columns[x].options.opened=true;obj.options.columns[x].options.onclose=function(el,value){obj.closeEditor(cell,true)};if(obj.options.columns[x].type=="color"){jSuites.color(editor,obj.options.columns[x].options)}else{jSuites.calendar(editor,obj.options.columns[x].options)}editor.focus()}else{if(obj.options.columns[x].type=="html"){var value=obj.options.data[y][x];var editor=createEditor("div");editor.style.position="relative";var div=document.createElement("div");div.classList.add("jexcel_richtext");editor.appendChild(div);jSuites.editor(div,{focus:true,value:value});var rect=cell.getBoundingClientRect();var rectContent=div.getBoundingClientRect();if(window.innerHeight<rect.bottom+rectContent.height){div.style.top=(rect.top-(rectContent.height+2))+"px"}else{div.style.top=(rect.top)+"px"}}else{if(obj.options.columns[x].type=="image"){var img=cell.children[0];var editor=createEditor("div");editor.style.position="relative";var div=document.createElement("div");div.classList.add("jclose");if(img&&img.src){div.appendChild(img)}editor.appendChild(div);jSuites.image(div,obj.options.imageOptions);var rect=cell.getBoundingClientRect();var rectContent=div.getBoundingClientRect();if(window.innerHeight<rect.bottom+rectContent.height){div.style.top=(rect.top-(rectContent.height+2))+"px"}else{div.style.top=(rect.top)+"px"}}else{var value=empty==true?"":obj.options.data[y][x];if(obj.options.columns[x].wordWrap!=false&&(obj.options.wordWrap==true||obj.options.columns[x].wordWrap==true)){var editor=createEditor("textarea")}else{var editor=createEditor("input")}editor.focus();editor.value=value;var options=obj.options.columns[x];var opt=null;if(!isFormula(value)){if(opt=getMask(options)){if(!options.disabledMaskOnEdition){if(options.mask){var m=options.mask.split(";");editor.setAttribute("data-mask",m[0])}else{if(options.locale){editor.setAttribute("data-locale",options.locale)}}}opt.input=editor;editor.mask=opt;jSuites.mask.render(value,opt,false)}}editor.onblur=function(){obj.closeEditor(cell,true)};editor.scrollLeft=editor.scrollWidth}}}}}}}}};obj.closeEditor=function(cell,save){var x=parseInt(cell.getAttribute("data-x"));var y=parseInt(cell.getAttribute("data-y"));if(save==true){if(obj.options.columns[x].editor){var value=obj.options.columns[x].editor.closeEditor(cell,save)}else{if(obj.options.columns[x].type=="checkbox"||obj.options.columns[x].type=="radio"||obj.options.columns[x].type=="hidden"){}else{if(obj.options.columns[x].type=="dropdown"||obj.options.columns[x].type=="autocomplete"){var value=cell.children[0].dropdown.close(true)}else{if(obj.options.columns[x].type=="calendar"){var value=cell.children[0].calendar.close(true)}else{if(obj.options.columns[x].type=="color"){var value=cell.children[0].color.close(true)}else{if(obj.options.columns[x].type=="html"){var value=cell.children[0].children[0].editor.getData()}else{if(obj.options.columns[x].type=="image"){var img=cell.children[0].children[0].children[0];var value=img&&img.tagName=="IMG"?img.src:""}else{if(obj.options.columns[x].type=="numeric"){var value=cell.children[0].value;if((""+value).substr(0,1)!="="){if(value==""){value=obj.options.columns[x].allowEmpty?"":0}}cell.children[0].onblur=null}else{var value=cell.children[0].value;cell.children[0].onblur=null;var options=obj.options.columns[x];var opt=null;if(opt=getMask(options)){if(value!==""&&!isFormula(value)&&typeof(value)!=="number"){var t=jSuites.mask.extract(value,opt,true);if(t&&t.value!==""){value=t.value}}}}}}}}}}}if(obj.options.data[y][x]==value){cell.innerHTML=obj.edition[1]}else{obj.setValue(cell,value)}}else{if(obj.options.columns[x].editor){obj.options.columns[x].editor.closeEditor(cell,save)}else{if(obj.options.columns[x].type=="dropdown"||obj.options.columns[x].type=="autocomplete"){cell.children[0].dropdown.close(true)}else{if(obj.options.columns[x].type=="calendar"){cell.children[0].calendar.close(true)}else{if(obj.options.columns[x].type=="color"){cell.children[0].color.close(true)}else{cell.children[0].onblur=null}}}}cell.innerHTML=obj.edition&&obj.edition[1]?obj.edition[1]:""}obj.dispatch("oneditionend",el,cell,x,y,value,save);cell.classList.remove("editor");obj.edition=null};obj.getCell=function(cell){cell=jexcel.getIdFromColumnName(cell,true);var x=cell[0];var y=cell[1];return obj.records[y][x]};obj.getCellFromCoords=function(x,y){return obj.records[y][x]};obj.getLabel=function(cell){cell=jexcel.getIdFromColumnName(cell,true);var x=cell[0];var y=cell[1];return obj.records[y][x].innerHTML};obj.getLabelFromCoords=function(x,y){return obj.records[y][x].innerHTML};obj.getValue=function(cell,processedValue){if(typeof(cell)=="object"){var x=cell.getAttribute("data-x");var y=cell.getAttribute("data-y")}else{cell=jexcel.getIdFromColumnName(cell,true);var x=cell[0];var y=cell[1]}var value=null;if(x!=null&&y!=null){if(obj.records[y]&&obj.records[y][x]&&(processedValue||obj.options.copyCompatibility==true)){value=obj.records[y][x].innerHTML}else{if(obj.options.data[y]&&obj.options.data[y][x]!="undefined"){value=obj.options.data[y][x]}}}return value};obj.getValueFromCoords=function(x,y,processedValue){var value=null;if(x!=null&&y!=null){if((obj.records[y]&&obj.records[y][x])&&processedValue||obj.options.copyCompatibility==true){value=obj.records[y][x].innerHTML}else{if(obj.options.data[y]&&obj.options.data[y][x]!="undefined"){value=obj.options.data[y][x]}}}return value};obj.setValue=function(cell,value,force){var records=[];if(typeof(cell)=="string"){var columnId=jexcel.getIdFromColumnName(cell,true);var x=columnId[0];var y=columnId[1];records.push(obj.updateCell(x,y,value,force));obj.updateFormulaChain(x,y,records)}else{var x=null;var y=null;if(cell&&cell.getAttribute){var x=cell.getAttribute("data-x");var y=cell.getAttribute("data-y")}if(x!=null&&y!=null){records.push(obj.updateCell(x,y,value,force));obj.updateFormulaChain(x,y,records)}else{var keys=Object.keys(cell);if(keys.length>0){for(var i=0;i<keys.length;i++){if(typeof(cell[i])=="string"){var columnId=jexcel.getIdFromColumnName(cell[i],true);var x=columnId[0];var y=columnId[1]}else{if(cell[i].x!=null&&cell[i].y!=null){var x=cell[i].x;var y=cell[i].y;if(cell[i].newValue!=null){value=cell[i].newValue}else{if(cell[i].value!=null){value=cell[i].value}}}else{var x=cell[i].getAttribute("data-x");var y=cell[i].getAttribute("data-y")}}if(x!=null&&y!=null){records.push(obj.updateCell(x,y,value,force));obj.updateFormulaChain(x,y,records)}}}}}obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell});obj.updateTable();obj.onafterchanges(el,records)};obj.setValueFromCoords=function(x,y,value,force){var records=[];records.push(obj.updateCell(x,y,value,force));obj.updateFormulaChain(x,y,records);obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell});obj.updateTable();obj.onafterchanges(el,records)};obj.setCheckRadioValue=function(){var records=[];var keys=Object.keys(obj.highlighted);for(var i=0;i<keys.length;i++){var x=obj.highlighted[i].getAttribute("data-x");var y=obj.highlighted[i].getAttribute("data-y");if(obj.options.columns[x].type=="checkbox"||obj.options.columns[x].type=="radio"){records.push(obj.updateCell(x,y,!obj.options.data[y][x]))}}if(records.length){obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell});obj.onafterchanges(el,records)}};var stripScript=function(a){var b=new Option;b.innerHTML=a;var c=null;for(a=b.getElementsByTagName("script");c=a[0];){c.parentNode.removeChild(c)}return b.innerHTML};obj.updateCell=function(x,y,value,force){if(obj.records[y][x].classList.contains("readonly")==true&&!force){var record={x:x,y:y,col:x,row:y}}else{if((""+value).substr(0,1)=="="&&obj.options.secureFormulas==true){var val=secureFormula(value);if(val!=value){value=val}}var val=obj.dispatch("onbeforechange",el,obj.records[y][x],x,y,value);if(val!=undefined){value=val}if(obj.options.columns[x].editor&&typeof(obj.options.columns[x].editor.updateCell)=="function"){value=obj.options.columns[x].editor.updateCell(obj.records[y][x],value,force)}var record={x:x,y:y,col:x,row:y,newValue:value,oldValue:obj.options.data[y][x]};if(obj.options.columns[x].editor){obj.options.data[y][x]=value}else{if(obj.options.columns[x].type=="checkbox"||obj.options.columns[x].type=="radio"){if(obj.options.columns[x].type=="radio"){for(var j=0;j<obj.options.data.length;j++){obj.options.data[j][x]=false}}obj.records[y][x].children[0].checked=(value==1||value==true||value=="true"||value=="TRUE")?true:false;obj.options.data[y][x]=obj.records[y][x].children[0].checked}else{if(obj.options.columns[x].type=="dropdown"||obj.options.columns[x].type=="autocomplete"){obj.options.data[y][x]=value;obj.records[y][x].innerText=obj.getDropDownValue(x,value)}else{if(obj.options.columns[x].type=="calendar"){var formatted=jSuites.calendar.extractDateFromString(value,obj.options.columns[x].options.format);obj.options.data[y][x]=value;obj.records[y][x].innerText=jSuites.calendar.getDateString(formatted?formatted:value,obj.options.columns[x].options.format)}else{if(obj.options.columns[x].type=="color"){obj.options.data[y][x]=value;if(obj.options.columns[x].render=="square"){var color=document.createElement("div");color.className="color";color.style.backgroundColor=value;obj.records[y][x].innerText="";obj.records[y][x].appendChild(color)}else{obj.records[y][x].style.color=value;obj.records[y][x].innerText=value}}else{if(obj.options.columns[x].type=="image"){value=""+value;obj.options.data[y][x]=value;obj.records[y][x].innerHTML="";if(value&&value.substr(0,10)=="data:image"){var img=document.createElement("img");img.src=value;obj.records[y][x].appendChild(img)}}else{obj.options.data[y][x]=value;if(obj.options.columns[x].type=="html"){obj.records[y][x].innerHTML=stripScript(obj.parseValue(x,y,value))}else{if(obj.options.stripHTML===false||obj.options.columns[x].stripHTML===false){obj.records[y][x].innerHTML=stripScript(obj.parseValue(x,y,value,obj.records[y][x]))}else{obj.records[y][x].innerText=obj.parseValue(x,y,value,obj.records[y][x])}}if(obj.options.columns[x].wordWrap!=false&&(obj.options.wordWrap==true||obj.options.columns[x].wordWrap==true||obj.records[y][x].innerHTML.length>200)){obj.records[y][x].style.whiteSpace="pre-wrap"}else{obj.records[y][x].style.whiteSpace=""}}}}}}}if(x>0){if(value){obj.records[y][x-1].style.overflow="hidden"}else{obj.records[y][x-1].style.overflow=""}}obj.dispatch("onchange",el,(obj.records[y]&&obj.records[y][x]?obj.records[y][x]:null),x,y,value,record.oldValue)}return record};obj.copyData=function(o,d){var data=obj.getData(true,true);var h=obj.selectedContainer;var x1=parseInt(o.getAttribute("data-x"));var y1=parseInt(o.getAttribute("data-y"));var x2=parseInt(d.getAttribute("data-x"));var y2=parseInt(d.getAttribute("data-y"));var records=[];var breakControl=false;if(h[0]==x1){if(y1<h[1]){var rowNumber=y1-h[1]}else{var rowNumber=1}var colNumber=0}else{if(x1<h[0]){var colNumber=x1-h[0]}else{var colNumber=1}var rowNumber=0}var posx=0;var posy=0;for(var j=y1;j<=y2;j++){if(obj.rows[j]&&obj.rows[j].style.display=="none"){continue}if(data[posy]==undefined){posy=0}posx=0;if(h[0]!=x1){if(x1<h[0]){var colNumber=x1-h[0]}else{var colNumber=1}}for(var i=x1;i<=x2;i++){if(obj.records[j][i]&&!obj.records[j][i].classList.contains("readonly")&&obj.records[j][i].style.display!="none"&&breakControl==false){if(!obj.selection.length){if(obj.options.data[j][i]!=""){breakControl=true;continue}}if(data[posy]==undefined){posx=0}else{if(data[posy][posx]==undefined){posx=0}}var value=data[posy][posx];if(value&&!data[1]&&obj.options.autoIncrement==true){if(obj.options.columns[i].type=="text"||obj.options.columns[i].type=="number"){if((""+value).substr(0,1)=="="){var tokens=value.match(/([A-Z]+[0-9]+)/g);if(tokens){var affectedTokens=[];for(var index=0;index<tokens.length;index++){var position=jexcel.getIdFromColumnName(tokens[index],1);position[0]+=colNumber;position[1]+=rowNumber;if(position[1]<0){position[1]=0}var token=jexcel.getColumnNameFromId([position[0],position[1]]);if(token!=tokens[index]){affectedTokens[tokens[index]]=token}}if(affectedTokens){value=obj.updateFormula(value,affectedTokens)}}}else{if(value==Number(value)){value=Number(value)+rowNumber}}}else{if(obj.options.columns[i].type=="calendar"){var date=new Date(value);date.setDate(date.getDate()+rowNumber);value=date.getFullYear()+"-"+jexcel.doubleDigitFormat(parseInt(date.getMonth()+1))+"-"+jexcel.doubleDigitFormat(date.getDate())+" 00:00:00"}}}records.push(obj.updateCell(i,j,value));obj.updateFormulaChain(i,j,records)}posx++;if(h[0]!=x1){colNumber++}}posy++;rowNumber++}obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell});obj.updateTable();obj.onafterchanges(el,records)};obj.refreshSelection=function(){if(obj.selectedCell){obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}};obj.conditionalSelectionUpdate=function(type,o,d){if(type==1){if(obj.selectedCell&&((o>=obj.selectedCell[1]&&o<=obj.selectedCell[3])||(d>=obj.selectedCell[1]&&d<=obj.selectedCell[3]))){obj.resetSelection();return}}else{if(obj.selectedCell&&((o>=obj.selectedCell[0]&&o<=obj.selectedCell[2])||(d>=obj.selectedCell[0]&&d<=obj.selectedCell[2]))){obj.resetSelection();return}}};obj.resetSelection=function(blur){if(!obj.highlighted.length){var previousStatus=0}else{var previousStatus=1;for(var i=0;i<obj.highlighted.length;i++){obj.highlighted[i].classList.remove("highlight");obj.highlighted[i].classList.remove("highlight-left");obj.highlighted[i].classList.remove("highlight-right");obj.highlighted[i].classList.remove("highlight-top");obj.highlighted[i].classList.remove("highlight-bottom");obj.highlighted[i].classList.remove("highlight-selected");var px=parseInt(obj.highlighted[i].getAttribute("data-x"));var py=parseInt(obj.highlighted[i].getAttribute("data-y"));if(obj.highlighted[i].getAttribute("data-merged")){var colspan=parseInt(obj.highlighted[i].getAttribute("colspan"));var rowspan=parseInt(obj.highlighted[i].getAttribute("rowspan"));var ux=colspan>0?px+(colspan-1):px;var uy=rowspan>0?py+(rowspan-1):py}else{var ux=px;var uy=py}for(var j=px;j<=ux;j++){if(obj.headers[j]){obj.headers[j].classList.remove("selected")}}for(var j=py;j<=uy;j++){if(obj.rows[j]){obj.rows[j].classList.remove("selected")}}}}obj.highlighted=[];obj.selectedCell=null;obj.corner.style.top="-2000px";obj.corner.style.left="-2000px";if(blur==true&&previousStatus==1){obj.dispatch("onblur",el)}return previousStatus};obj.updateSelection=function(el1,el2,origin){var x1=el1.getAttribute("data-x");var y1=el1.getAttribute("data-y");if(el2){var x2=el2.getAttribute("data-x");var y2=el2.getAttribute("data-y")}else{var x2=x1;var y2=y1}obj.updateSelectionFromCoords(x1,y1,x2,y2,origin)};obj.updateSelectionFromCoords=function(x1,y1,x2,y2,origin){var updated=null;var previousState=obj.resetSelection();if(y1==null){y1=0;y2=obj.rows.length-1}if(x2==null){x2=x1}if(y2==null){y2=y1}if(x1>=obj.headers.length){x1=obj.headers.length-1}if(y1>=obj.rows.length){y1=obj.rows.length-1}if(x2>=obj.headers.length){x2=obj.headers.length-1}if(y2>=obj.rows.length){y2=obj.rows.length-1}obj.selectedCell=[x1,y1,x2,y2];if(x1!=null){if(obj.records[y1][x1]){obj.records[y1][x1].classList.add("highlight-selected")}if(parseInt(x1)<parseInt(x2)){var px=parseInt(x1);var ux=parseInt(x2)}else{var px=parseInt(x2);var ux=parseInt(x1)}if(parseInt(y1)<parseInt(y2)){var py=parseInt(y1);var uy=parseInt(y2)}else{var py=parseInt(y2);var uy=parseInt(y1)}for(var i=px;i<=ux;i++){for(var j=py;j<=uy;j++){if(obj.records[j][i]&&obj.records[j][i].getAttribute("data-merged")){var x=parseInt(obj.records[j][i].getAttribute("data-x"));var y=parseInt(obj.records[j][i].getAttribute("data-y"));var colspan=parseInt(obj.records[j][i].getAttribute("colspan"));var rowspan=parseInt(obj.records[j][i].getAttribute("rowspan"));if(colspan>1){if(x<px){px=x}if(x+colspan>ux){ux=x+colspan-1}}if(rowspan){if(y<py){py=y}if(y+rowspan>uy){uy=y+rowspan-1}}}}}var borderLeft=null;var borderRight=null;var borderTop=null;var borderBottom=null;for(var j=py;j<=uy;j++){if(obj.rows[j].style.display!="none"){if(borderTop==null){borderTop=j}borderBottom=j}}for(var i=px;i<=ux;i++){for(var j=py;j<=uy;j++){if(obj.rows[j].style.display!="none"&&obj.records[j][i].style.display!="none"){obj.records[j][i].classList.add("highlight");obj.highlighted.push(obj.records[j][i])}}if(obj.options.columns[i].type!="hidden"){if(borderLeft==null){borderLeft=i}borderRight=i}}if(!borderLeft){borderLeft=0}if(!borderRight){borderRight=0}for(var i=borderLeft;i<=borderRight;i++){if(obj.options.columns[i].type!="hidden"){if(obj.records[borderTop]&&obj.records[borderTop][i]){obj.records[borderTop][i].classList.add("highlight-top")}if(obj.records[borderBottom]&&obj.records[borderBottom][i]){obj.records[borderBottom][i].classList.add("highlight-bottom")}obj.headers[i].classList.add("selected")}}for(var j=borderTop;j<=borderBottom;j++){if(obj.rows[j]&&obj.rows[j].style.display!="none"){obj.records[j][borderLeft].classList.add("highlight-left");obj.records[j][borderRight].classList.add("highlight-right");obj.rows[j].classList.add("selected")}}obj.selectedContainer=[borderLeft,borderTop,borderRight,borderBottom]}if(previousState==0){obj.dispatch("onfocus",el);obj.removeCopyingSelection()}obj.dispatch("onselection",el,borderLeft,borderTop,borderRight,borderBottom,origin);obj.updateCornerPosition()};obj.removeCopySelection=function(){for(var i=0;i<obj.selection.length;i++){obj.selection[i].classList.remove("selection");obj.selection[i].classList.remove("selection-left");obj.selection[i].classList.remove("selection-right");obj.selection[i].classList.remove("selection-top");obj.selection[i].classList.remove("selection-bottom")}obj.selection=[]};obj.updateCopySelection=function(x3,y3){obj.removeCopySelection();var x1=obj.selectedContainer[0];var y1=obj.selectedContainer[1];var x2=obj.selectedContainer[2];var y2=obj.selectedContainer[3];if(x3!=null&&y3!=null){if(x3-x2>0){var px=parseInt(x2)+1;var ux=parseInt(x3)}else{var px=parseInt(x3);var ux=parseInt(x1)-1}if(y3-y2>0){var py=parseInt(y2)+1;var uy=parseInt(y3)}else{var py=parseInt(y3);var uy=parseInt(y1)-1}if(ux-px<=uy-py){var px=parseInt(x1);var ux=parseInt(x2)}else{var py=parseInt(y1);var uy=parseInt(y2)}for(var j=py;j<=uy;j++){for(var i=px;i<=ux;i++){if(obj.records[j][i]&&obj.rows[j].style.display!="none"&&obj.records[j][i].style.display!="none"){obj.records[j][i].classList.add("selection");obj.records[py][i].classList.add("selection-top");obj.records[uy][i].classList.add("selection-bottom");obj.records[j][px].classList.add("selection-left");obj.records[j][ux].classList.add("selection-right");obj.selection.push(obj.records[j][i])}}}}};obj.updateCornerPosition=function(){if(!obj.highlighted.length){obj.corner.style.top="-2000px";obj.corner.style.left="-2000px"}else{var last=obj.highlighted[obj.highlighted.length-1];var contentRect=obj.content.getBoundingClientRect();var x1=contentRect.left;var y1=contentRect.top;var lastRect=last.getBoundingClientRect();var x2=lastRect.left;var y2=lastRect.top;var w2=lastRect.width;var h2=lastRect.height;var x=(x2-x1)+obj.content.scrollLeft+w2-4;var y=(y2-y1)+obj.content.scrollTop+h2-4;obj.corner.style.top=y+"px";obj.corner.style.left=x+"px";if(obj.options.freezeColumns){var width=obj.getFreezeWidth();if(x2-x1+w2<width){obj.corner.style.display="none"}else{if(obj.options.selectionCopy==true){obj.corner.style.display=""}}}else{if(obj.options.selectionCopy==true){obj.corner.style.display=""}}}};obj.updateScroll=function(direction){var contentRect=obj.content.getBoundingClientRect();var x1=contentRect.left;var y1=contentRect.top;var w1=contentRect.width;var h1=contentRect.height;var reference=obj.records[obj.selectedCell[3]][obj.selectedCell[2]];var referenceRect=reference.getBoundingClientRect();var x2=referenceRect.left;var y2=referenceRect.top;var w2=referenceRect.width;var h2=referenceRect.height;if(direction==0||direction==1){var x=(x2-x1)+obj.content.scrollLeft;var y=(y2-y1)+obj.content.scrollTop-2}else{var x=(x2-x1)+obj.content.scrollLeft+w2;var y=(y2-y1)+obj.content.scrollTop+h2}if(y>(obj.content.scrollTop+30)&&y<(obj.content.scrollTop+h1)){}else{if(y<obj.content.scrollTop+30){obj.content.scrollTop=y-h2}else{obj.content.scrollTop=y-(h1-2)}}var freezed=obj.getFreezeWidth();if(x>(obj.content.scrollLeft+freezed)&&x<(obj.content.scrollLeft+w1)){}else{if(x<obj.content.scrollLeft+30){obj.content.scrollLeft=x;if(obj.content.scrollLeft<50){obj.content.scrollLeft=0}}else{if(x<obj.content.scrollLeft+freezed){obj.content.scrollLeft=x-freezed-1}else{obj.content.scrollLeft=x-(w1-20)}}}};obj.getWidth=function(column){if(!column){var data=[];for(var i=0;i<obj.headers.length;i++){data.push(obj.options.columns[i].width)}}else{if(typeof(column)=="object"){column=$(column).getAttribute("data-x")}data=obj.colgroup[column].getAttribute("width")}return data};obj.setWidth=function(column,width,oldWidth){if(width){if(Array.isArray(column)){if(!oldWidth){var oldWidth=[]}for(var i=0;i<column.length;i++){if(!oldWidth[i]){oldWidth[i]=obj.colgroup[column[i]].getAttribute("width")}var w=Array.isArray(width)&&width[i]?width[i]:width;obj.colgroup[column[i]].setAttribute("width",w);obj.options.columns[column[i]].width=w}}else{if(!oldWidth){oldWidth=obj.colgroup[column].getAttribute("width")}obj.colgroup[column].setAttribute("width",width);obj.options.columns[column].width=width}obj.setHistory({action:"setWidth",column:column,oldValue:oldWidth,newValue:width});obj.dispatch("onresizecolumn",el,column,width,oldWidth);obj.updateCornerPosition()}};obj.setHeight=function(row,height,oldHeight){if(height>0){if(typeof(row)=="object"){row=row.getAttribute("data-y")}if(!oldHeight){oldHeight=obj.rows[row].getAttribute("height");if(!oldHeight){var rect=obj.rows[row].getBoundingClientRect();oldHeight=rect.height}}height=parseInt(height);obj.rows[row].style.height=height+"px";if(!obj.options.rows[row]){obj.options.rows[row]={}}obj.options.rows[row].height=height;obj.setHistory({action:"setHeight",row:row,oldValue:oldHeight,newValue:height});obj.dispatch("onresizerow",el,row,height,oldHeight);obj.updateCornerPosition()}};obj.getHeight=function(row){if(!row){var data=[];for(var j=0;j<obj.rows.length;j++){var h=obj.rows[j].style.height;if(h){data[j]=h}}}else{if(typeof(row)=="object"){row=$(row).getAttribute("data-y")}var data=obj.rows[row].style.height}return data};obj.setFooter=function(data){if(data){obj.options.footers=data}if(obj.options.footers){if(!obj.tfoot){obj.tfoot=document.createElement("tfoot");obj.table.appendChild(obj.tfoot)}for(var j=0;j<obj.options.footers.length;j++){if(obj.tfoot.children[j]){var tr=obj.tfoot.children[j]}else{var tr=document.createElement("tr");var td=document.createElement("td");tr.appendChild(td);obj.tfoot.appendChild(tr)}for(var i=0;i<obj.headers.length;i++){if(!obj.options.footers[j][i]){obj.options.footers[j][i]=""}if(obj.tfoot.children[j].children[i+1]){var td=obj.tfoot.children[j].children[i+1]}else{var td=document.createElement("td");tr.appendChild(td);var colAlign=obj.options.columns[i].align?obj.options.columns[i].align:"center";td.style.textAlign=colAlign}td.innerText=obj.parseValue(i,j,obj.options.footers[j][i])}}}};obj.getHeader=function(column){return obj.headers[column].innerText};obj.setHeader=function(column,newValue){if(obj.headers[column]){var oldValue=obj.headers[column].innerText;if(!newValue){newValue=prompt(obj.options.text.columnName,oldValue)}if(newValue){obj.headers[column].innerText=newValue;obj.headers[column].setAttribute("title",newValue);obj.options.columns[column].title=newValue}obj.setHistory({action:"setHeader",column:column,oldValue:oldValue,newValue:newValue});obj.dispatch("onchangeheader",el,column,oldValue,newValue)}};obj.getHeaders=function(asArray){var title=[];for(var i=0;i<obj.headers.length;i++){title.push(obj.getHeader(i))}return asArray?title:title.join(obj.options.csvDelimiter)};obj.getMeta=function(cell,key){if(!cell){return obj.options.meta}else{if(key){return obj.options.meta[cell]&&obj.options.meta[cell][key]?obj.options.meta[cell][key]:null}else{return obj.options.meta[cell]?obj.options.meta[cell]:null}}};obj.setMeta=function(o,k,v){if(!obj.options.meta){obj.options.meta={}}if(k&&v){if(!obj.options.meta[o]){obj.options.meta[o]={}}obj.options.meta[o][k]=v}else{var keys=Object.keys(o);for(var i=0;i<keys.length;i++){if(!obj.options.meta[keys[i]]){obj.options.meta[keys[i]]={}}var prop=Object.keys(o[keys[i]]);for(var j=0;j<prop.length;j++){obj.options.meta[keys[i]][prop[j]]=o[keys[i]][prop[j]]}}}obj.dispatch("onchangemeta",el,o,k,v)};obj.updateMeta=function(affectedCells){if(obj.options.meta){var newMeta={};var keys=Object.keys(obj.options.meta);for(var i=0;i<keys.length;i++){if(affectedCells[keys[i]]){newMeta[affectedCells[keys[i]]]=obj.options.meta[keys[i]]}else{newMeta[keys[i]]=obj.options.meta[keys[i]]}}obj.options.meta=newMeta}};obj.getStyle=function(cell,key){if(!cell){var data={};var x=obj.options.data[0].length;var y=obj.options.data.length;for(var j=0;j<y;j++){for(var i=0;i<x;i++){var v=key?obj.records[j][i].style[key]:obj.records[j][i].getAttribute("style");if(v){var k=jexcel.getColumnNameFromId([i,j]);data[k]=v}}}return data}else{cell=jexcel.getIdFromColumnName(cell,true);return key?obj.records[cell[1]][cell[0]].style[key]:obj.records[cell[1]][cell[0]].getAttribute("style")}},obj.resetStyle=function(o,ignoreHistoryAndEvents){var keys=Object.keys(o);for(var i=0;i<keys.length;i++){var cell=jexcel.getIdFromColumnName(keys[i],true);if(obj.records[cell[1]]&&obj.records[cell[1]][cell[0]]){obj.records[cell[1]][cell[0]].setAttribute("style","")}}obj.setStyle(o,null,null,null,ignoreHistoryAndEvents)};obj.setStyle=function(o,k,v,force,ignoreHistoryAndEvents){var newValue={};var oldValue={};var applyStyle=function(cellId,key,value){var cell=jexcel.getIdFromColumnName(cellId,true);if(obj.records[cell[1]]&&obj.records[cell[1]][cell[0]]&&(obj.records[cell[1]][cell[0]].classList.contains("readonly")==false||force)){var currentValue=obj.records[cell[1]][cell[0]].style[key];if(currentValue==value&&!force){value="";obj.records[cell[1]][cell[0]].style[key]=""}else{obj.records[cell[1]][cell[0]].style[key]=value}if(!oldValue[cellId]){oldValue[cellId]=[]}if(!newValue[cellId]){newValue[cellId]=[]}oldValue[cellId].push([key+":"+currentValue]);newValue[cellId].push([key+":"+value])}};if(k&&v){if(typeof(o)=="string"){applyStyle(o,k,v)}else{var oneApplication=[];for(var i=0;i<o.length;i++){var x=o[i].getAttribute("data-x");var y=o[i].getAttribute("data-y");var cellName=jexcel.getColumnNameFromId([x,y]);if(!oneApplication[cellName]){applyStyle(cellName,k,v);oneApplication[cellName]=true}}}}else{var keys=Object.keys(o);for(var i=0;i<keys.length;i++){var style=o[keys[i]];if(typeof(style)=="string"){style=style.split(";")}for(var j=0;j<style.length;j++){if(typeof(style[j])=="string"){style[j]=style[j].split(":")}if(style[j][0].trim()){applyStyle(keys[i],style[j][0].trim(),style[j][1])}}}}var keys=Object.keys(oldValue);for(var i=0;i<keys.length;i++){oldValue[keys[i]]=oldValue[keys[i]].join(";")}var keys=Object.keys(newValue);for(var i=0;i<keys.length;i++){newValue[keys[i]]=newValue[keys[i]].join(";")}if(!ignoreHistoryAndEvents){obj.setHistory({action:"setStyle",oldValue:oldValue,newValue:newValue})}obj.dispatch("onchangestyle",el,o,k,v)};obj.getComments=function(cell,withAuthor){if(cell){if(typeof(cell)=="string"){var cell=jexcel.getIdFromColumnName(cell,true)}if(withAuthor){return[obj.records[cell[1]][cell[0]].getAttribute("title"),obj.records[cell[1]][cell[0]].getAttribute("author")]}else{return obj.records[cell[1]][cell[0]].getAttribute("title")||""}}else{var data={};for(var j=0;j<obj.options.data.length;j++){for(var i=0;i<obj.options.columns.length;i++){var comments=obj.records[j][i].getAttribute("title");if(comments){var cell=jexcel.getColumnNameFromId([i,j]);data[cell]=comments}}}return data}};obj.setComments=function(cellId,comments,author){if(typeof(cellId)=="string"){var cell=jexcel.getIdFromColumnName(cellId,true)}else{var cell=cellId}var title=obj.records[cell[1]][cell[0]].getAttribute("title");var author=obj.records[cell[1]][cell[0]].getAttribute("data-author");var oldValue=[title,author];obj.records[cell[1]][cell[0]].setAttribute("title",comments?comments:"");obj.records[cell[1]][cell[0]].setAttribute("data-author",author?author:"");if(comments){obj.records[cell[1]][cell[0]].classList.add("jexcel_comments")}else{obj.records[cell[1]][cell[0]].classList.remove("jexcel_comments")}obj.setHistory({action:"setComments",column:cellId,newValue:[comments,author],oldValue:oldValue});obj.dispatch("oncomments",el,comments,title,cell,cell[0],cell[1])};obj.getConfig=function(){var options=obj.options;options.style=obj.getStyle();options.mergeCells=obj.getMerge();options.comments=obj.getComments();return options};obj.orderBy=function(column,order){if(column>=0){if(Object.keys(obj.options.mergeCells).length>0){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}if(order==null){order=obj.headers[column].classList.contains("arrow-down")?1:0}else{order=order?1:0}var temp=[];if(obj.options.columns[column].type=="number"||obj.options.columns[column].type=="percentage"||obj.options.columns[column].type=="autonumber"||obj.options.columns[column].type=="color"){for(var j=0;j<obj.options.data.length;j++){temp[j]=[j,Number(obj.options.data[j][column])]}}else{if(obj.options.columns[column].type=="calendar"||obj.options.columns[column].type=="checkbox"||obj.options.columns[column].type=="radio"){for(var j=0;j<obj.options.data.length;j++){temp[j]=[j,obj.options.data[j][column]]}}else{for(var j=0;j<obj.options.data.length;j++){temp[j]=[j,obj.records[j][column].innerText.toLowerCase()]}}}if(typeof(obj.options.sorting)!=="function"){obj.options.sorting=function(direction){return function(a,b){var valueA=a[1];var valueB=b[1];if(!direction){return(valueA===""&&valueB!=="")?1:(valueA!==""&&valueB==="")?-1:(valueA>valueB)?1:(valueA<valueB)?-1:0}else{return(valueA===""&&valueB!=="")?1:(valueA!==""&&valueB==="")?-1:(valueA>valueB)?-1:(valueA<valueB)?1:0}}}}temp=temp.sort(obj.options.sorting(order));var newValue=[];for(var j=0;j<temp.length;j++){newValue[j]=temp[j][0]}obj.setHistory({action:"orderBy",rows:newValue,column:column,order:order});obj.updateOrderArrow(column,order);obj.updateOrder(newValue);obj.dispatch("onsort",el,column,order);return true}};obj.updateOrderArrow=function(column,order){for(var i=0;i<obj.headers.length;i++){obj.headers[i].classList.remove("arrow-up");obj.headers[i].classList.remove("arrow-down")}if(order){obj.headers[column].classList.add("arrow-up")}else{obj.headers[column].classList.add("arrow-down")}};obj.updateOrder=function(rows){var data=[];for(var j=0;j<rows.length;j++){data[j]=obj.options.data[rows[j]]}obj.options.data=data;var data=[];for(var j=0;j<rows.length;j++){data[j]=obj.records[rows[j]]}obj.records=data;var data=[];for(var j=0;j<rows.length;j++){data[j]=obj.rows[rows[j]]}obj.rows=data;obj.updateTableReferences();if(obj.results&&obj.results.length){if(obj.searchInput.value){obj.search(obj.searchInput.value)}else{obj.closeFilter()}}else{obj.results=null;obj.pageNumber=0;if(obj.options.pagination>0){obj.page(0)}else{if(obj.options.lazyLoading==true){obj.loadPage(0)}else{for(var j=0;j<obj.rows.length;j++){obj.tbody.appendChild(obj.rows[j])}}}}};obj.moveRow=function(o,d,ignoreDom){if(Object.keys(obj.options.mergeCells).length>0){if(o>d){var insertBefore=1}else{var insertBefore=0}if(obj.isRowMerged(o).length||obj.isRowMerged(d,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}}if(obj.options.search==true){if(obj.results&&obj.results.length!=obj.rows.length){if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)){obj.resetSearch()}else{return false}}obj.results=null}if(!ignoreDom){if(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[d])>=0){if(o>d){obj.tbody.insertBefore(obj.rows[o],obj.rows[d])}else{obj.tbody.insertBefore(obj.rows[o],obj.rows[d].nextSibling)}}else{obj.tbody.removeChild(obj.rows[o])}}obj.rows.splice(d,0,obj.rows.splice(o,1)[0]);obj.records.splice(d,0,obj.records.splice(o,1)[0]);obj.options.data.splice(d,0,obj.options.data.splice(o,1)[0]);if(obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination){obj.page(obj.pageNumber)}obj.setHistory({action:"moveRow",oldValue:o,newValue:d});obj.updateTableReferences();obj.dispatch("onmoverow",el,o,d)};obj.insertRow=function(mixed,rowNumber,insertBefore){if(obj.options.allowInsertRow==true){var records=[];var data=[];if(mixed>0){var numOfRows=mixed}else{var numOfRows=1;if(mixed){data=mixed}}var insertBefore=insertBefore?true:false;var lastRow=obj.options.data.length-1;if(rowNumber==undefined||rowNumber>=parseInt(lastRow)||rowNumber<0){rowNumber=lastRow}if(obj.dispatch("onbeforeinsertrow",el,rowNumber,numOfRows,insertBefore)===false){return false}if(Object.keys(obj.options.mergeCells).length>0){if(obj.isRowMerged(rowNumber,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}}if(obj.options.search==true){if(obj.results&&obj.results.length!=obj.rows.length){if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)){obj.resetSearch()}else{return false}}obj.results=null}var rowIndex=(!insertBefore)?rowNumber+1:rowNumber;var currentRecords=obj.records.splice(rowIndex);var currentData=obj.options.data.splice(rowIndex);var currentRows=obj.rows.splice(rowIndex);var rowRecords=[];var rowData=[];var rowNode=[];for(var row=rowIndex;row<(numOfRows+rowIndex);row++){obj.options.data[row]=[];for(var col=0;col<obj.options.columns.length;col++){obj.options.data[row][col]=data[col]?data[col]:""}var tr=obj.createRow(row,obj.options.data[row]);if(currentRows[0]){if(Array.prototype.indexOf.call(obj.tbody.children,currentRows[0])>=0){obj.tbody.insertBefore(tr,currentRows[0])}}else{if(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[rowNumber])>=0){obj.tbody.appendChild(tr)}}rowRecords.push(obj.records[row]);rowData.push(obj.options.data[row]);rowNode.push(tr)}Array.prototype.push.apply(obj.records,currentRecords);Array.prototype.push.apply(obj.options.data,currentData);Array.prototype.push.apply(obj.rows,currentRows);if(obj.options.pagination>0){obj.page(obj.pageNumber)}obj.setHistory({action:"insertRow",rowNumber:rowNumber,numOfRows:numOfRows,insertBefore:insertBefore,rowRecords:rowRecords,rowData:rowData,rowNode:rowNode});obj.updateTableReferences();obj.dispatch("oninsertrow",el,rowNumber,numOfRows,rowRecords,insertBefore)}};obj.deleteRow=function(rowNumber,numOfRows){if(obj.options.allowDeleteRow==true){if(obj.options.allowDeletingAllRows==true||obj.options.data.length>1){if(rowNumber==undefined){var number=obj.getSelectedRows();if(!number[0]){rowNumber=obj.options.data.length-1;numOfRows=1}else{rowNumber=parseInt(number[0].getAttribute("data-y"));numOfRows=number.length}}var lastRow=obj.options.data.length-1;if(rowNumber==undefined||rowNumber>lastRow||rowNumber<0){rowNumber=lastRow}if(!numOfRows){numOfRows=1}if(rowNumber+numOfRows>=obj.options.data.length){numOfRows=obj.options.data.length-rowNumber}if(obj.dispatch("onbeforedeleterow",el,rowNumber,numOfRows)===false){return false}if(parseInt(rowNumber)>-1){var mergeExists=false;if(Object.keys(obj.options.mergeCells).length>0){for(var row=rowNumber;row<rowNumber+numOfRows;row++){if(obj.isRowMerged(row,false).length){mergeExists=true}}}if(mergeExists){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}if(obj.options.search==true){if(obj.results&&obj.results.length!=obj.rows.length){if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)){obj.resetSearch()}else{return false}}obj.results=null}if(obj.options.allowDeletingAllRows==false&&lastRow+1===numOfRows){numOfRows--;console.error("Jspreadsheet: It is not possible to delete the last row")}for(var row=rowNumber;row<rowNumber+numOfRows;row++){if(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[row])>=0){obj.rows[row].className="";obj.rows[row].parentNode.removeChild(obj.rows[row])}}var rowRecords=obj.records.splice(rowNumber,numOfRows);var rowData=obj.options.data.splice(rowNumber,numOfRows);var rowNode=obj.rows.splice(rowNumber,numOfRows);if(obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination){obj.page(obj.pageNumber)}obj.conditionalSelectionUpdate(1,rowNumber,(rowNumber+numOfRows)-1);obj.setHistory({action:"deleteRow",rowNumber:rowNumber,numOfRows:numOfRows,insertBefore:1,rowRecords:rowRecords,rowData:rowData,rowNode:rowNode});obj.updateTableReferences();obj.dispatch("ondeleterow",el,rowNumber,numOfRows,rowRecords)}}else{console.error("Jspreadsheet: It is not possible to delete the last row")}}};obj.moveColumn=function(o,d){if(Object.keys(obj.options.mergeCells).length>0){if(o>d){var insertBefore=1}else{var insertBefore=0}if(obj.isColMerged(o).length||obj.isColMerged(d,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}}var o=parseInt(o);var d=parseInt(d);if(o>d){obj.headerContainer.insertBefore(obj.headers[o],obj.headers[d]);obj.colgroupContainer.insertBefore(obj.colgroup[o],obj.colgroup[d]);for(var j=0;j<obj.rows.length;j++){obj.rows[j].insertBefore(obj.records[j][o],obj.records[j][d])}}else{obj.headerContainer.insertBefore(obj.headers[o],obj.headers[d].nextSibling);obj.colgroupContainer.insertBefore(obj.colgroup[o],obj.colgroup[d].nextSibling);for(var j=0;j<obj.rows.length;j++){obj.rows[j].insertBefore(obj.records[j][o],obj.records[j][d].nextSibling)}}obj.options.columns.splice(d,0,obj.options.columns.splice(o,1)[0]);obj.headers.splice(d,0,obj.headers.splice(o,1)[0]);obj.colgroup.splice(d,0,obj.colgroup.splice(o,1)[0]);for(var j=0;j<obj.rows.length;j++){obj.options.data[j].splice(d,0,obj.options.data[j].splice(o,1)[0]);obj.records[j].splice(d,0,obj.records[j].splice(o,1)[0])}if(obj.options.footers){for(var j=0;j<obj.options.footers.length;j++){obj.options.footers[j].splice(d,0,obj.options.footers[j].splice(o,1)[0])}}obj.setHistory({action:"moveColumn",oldValue:o,newValue:d});obj.updateTableReferences();obj.dispatch("onmovecolumn",el,o,d)};obj.insertColumn=function(mixed,columnNumber,insertBefore,properties){if(obj.options.allowInsertColumn==true){var records=[];var data=[];if(mixed>0){var numOfColumns=mixed}else{var numOfColumns=1;if(mixed){data=mixed}}var insertBefore=insertBefore?true:false;var lastColumn=obj.options.columns.length-1;if(columnNumber==undefined||columnNumber>=parseInt(lastColumn)||columnNumber<0){columnNumber=lastColumn}if(obj.dispatch("onbeforeinsertcolumn",el,columnNumber,numOfColumns,insertBefore)===false){return false}if(Object.keys(obj.options.mergeCells).length>0){if(obj.isColMerged(columnNumber,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}}if(!properties){properties=[]}for(var i=0;i<numOfColumns;i++){if(!properties[i]){properties[i]={type:"text",source:[],options:[],width:obj.options.defaultColWidth,align:obj.options.defaultColAlign}}}var columnIndex=(!insertBefore)?columnNumber+1:columnNumber;obj.options.columns=jexcel.injectArray(obj.options.columns,columnIndex,properties);var currentHeaders=obj.headers.splice(columnIndex);var currentColgroup=obj.colgroup.splice(columnIndex);var historyHeaders=[];var historyColgroup=[];var historyRecords=[];var historyData=[];var historyFooters=[];for(var col=columnIndex;col<(numOfColumns+columnIndex);col++){obj.createCellHeader(col);obj.headerContainer.insertBefore(obj.headers[col],obj.headerContainer.children[col+1]);obj.colgroupContainer.insertBefore(obj.colgroup[col],obj.colgroupContainer.children[col+1]);historyHeaders.push(obj.headers[col]);historyColgroup.push(obj.colgroup[col])}if(obj.options.footers){for(var j=0;j<obj.options.footers.length;j++){historyFooters[j]=[];for(var i=0;i<numOfColumns;i++){historyFooters[j].push("")}obj.options.footers[j].splice(columnIndex,0,historyFooters[j])}}for(var row=0;row<obj.options.data.length;row++){var currentData=obj.options.data[row].splice(columnIndex);var currentRecord=obj.records[row].splice(columnIndex);historyData[row]=[];historyRecords[row]=[];for(var col=columnIndex;col<(numOfColumns+columnIndex);col++){var value=data[row]?data[row]:"";obj.options.data[row][col]=value;var td=obj.createCell(col,row,obj.options.data[row][col]);obj.records[row][col]=td;if(obj.rows[row]){obj.rows[row].insertBefore(td,obj.rows[row].children[col+1])}historyData[row].push(value);historyRecords[row].push(td)}Array.prototype.push.apply(obj.options.data[row],currentData);Array.prototype.push.apply(obj.records[row],currentRecord)}Array.prototype.push.apply(obj.headers,currentHeaders);Array.prototype.push.apply(obj.colgroup,currentColgroup);if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]){for(var j=0;j<obj.options.nestedHeaders.length;j++){var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)+numOfColumns;obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan;obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan);var o=obj.thead.children[j].children[obj.thead.children[j].children.length-1].getAttribute("data-column");o=o.split(",");for(var col=columnIndex;col<(numOfColumns+columnIndex);col++){o.push(col)}obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("data-column",o)}}else{var colspan=parseInt(obj.options.nestedHeaders[0].colspan)+numOfColumns;obj.options.nestedHeaders[0].colspan=colspan;obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}}obj.setHistory({action:"insertColumn",columnNumber:columnNumber,numOfColumns:numOfColumns,insertBefore:insertBefore,columns:properties,headers:historyHeaders,colgroup:historyColgroup,records:historyRecords,footers:historyFooters,data:historyData});obj.updateTableReferences();obj.dispatch("oninsertcolumn",el,columnNumber,numOfColumns,historyRecords,insertBefore)}};obj.deleteColumn=function(columnNumber,numOfColumns){if(obj.options.allowDeleteColumn==true){if(obj.headers.length>1){if(columnNumber==undefined){var number=obj.getSelectedColumns(true);if(!number.length){columnNumber=obj.headers.length-1;numOfColumns=1}else{columnNumber=parseInt(number[0]);numOfColumns=parseInt(number.length)}}var lastColumn=obj.options.data[0].length-1;if(columnNumber==undefined||columnNumber>lastColumn||columnNumber<0){columnNumber=lastColumn}if(!numOfColumns){numOfColumns=1}if(numOfColumns>obj.options.data[0].length-columnNumber){numOfColumns=obj.options.data[0].length-columnNumber}if(obj.dispatch("onbeforedeletecolumn",el,columnNumber,numOfColumns)===false){return false}if(parseInt(columnNumber)>-1){var mergeExists=false;if(Object.keys(obj.options.mergeCells).length>0){for(var col=columnNumber;col<columnNumber+numOfColumns;col++){if(obj.isColMerged(col,false).length){mergeExists=true}}}if(mergeExists){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)){return false}else{obj.destroyMerged()}}var columns=obj.options.columns.splice(columnNumber,numOfColumns);for(var col=columnNumber;col<columnNumber+numOfColumns;col++){obj.colgroup[col].className="";obj.headers[col].className="";obj.colgroup[col].parentNode.removeChild(obj.colgroup[col]);obj.headers[col].parentNode.removeChild(obj.headers[col])}var historyHeaders=obj.headers.splice(columnNumber,numOfColumns);var historyColgroup=obj.colgroup.splice(columnNumber,numOfColumns);var historyRecords=[];var historyData=[];var historyFooters=[];for(var row=0;row<obj.options.data.length;row++){for(var col=columnNumber;col<columnNumber+numOfColumns;col++){obj.records[row][col].className="";obj.records[row][col].parentNode.removeChild(obj.records[row][col])}}for(var row=0;row<obj.options.data.length;row++){historyData[row]=obj.options.data[row].splice(columnNumber,numOfColumns);historyRecords[row]=obj.records[row].splice(columnNumber,numOfColumns)}if(obj.options.footers){for(var row=0;row<obj.options.footers.length;row++){historyFooters[row]=obj.options.footers[row].splice(columnNumber,numOfColumns)}}obj.conditionalSelectionUpdate(0,columnNumber,(columnNumber+numOfColumns)-1);if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]){for(var j=0;j<obj.options.nestedHeaders.length;j++){var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)-numOfColumns;obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan;obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan)}}else{var colspan=parseInt(obj.options.nestedHeaders[0].colspan)-numOfColumns;obj.options.nestedHeaders[0].colspan=colspan;obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}}obj.setHistory({action:"deleteColumn",columnNumber:columnNumber,numOfColumns:numOfColumns,insertBefore:1,columns:columns,headers:historyHeaders,colgroup:historyColgroup,records:historyRecords,footers:historyFooters,data:historyData});obj.updateTableReferences();obj.dispatch("ondeletecolumn",el,columnNumber,numOfColumns,historyRecords)}}else{console.error("Jspreadsheet: It is not possible to delete the last column")}}};obj.getSelectedRows=function(asIds){var rows=[];for(var j=0;j<obj.rows.length;j++){if(obj.rows[j].classList.contains("selected")){if(asIds){rows.push(j)}else{rows.push(obj.rows[j])}}}return rows},obj.getSelectedColumns=function(){var cols=[];for(var i=0;i<obj.headers.length;i++){if(obj.headers[i].classList.contains("selected")){cols.push(i)}}return cols};obj.getHighlighted=function(){return obj.highlighted};obj.updateTableReferences=function(){for(var i=0;i<obj.headers.length;i++){var x=obj.headers[i].getAttribute("data-x");if(x!=i){obj.headers[i].setAttribute("data-x",i);if(!obj.headers[i].getAttribute("title")){obj.headers[i].innerHTML=jexcel.getColumnName(i)}}}for(var j=0;j<obj.rows.length;j++){if(obj.rows[j]){var y=obj.rows[j].getAttribute("data-y");if(y!=j){obj.rows[j].setAttribute("data-y",j);obj.rows[j].children[0].setAttribute("data-y",j);obj.rows[j].children[0].innerHTML=j+1}}}var affectedTokens=[];var mergeCellUpdates=[];var updatePosition=function(x,y,i,j){if(x!=i){obj.records[j][i].setAttribute("data-x",i)}if(y!=j){obj.records[j][i].setAttribute("data-y",j)}if(x!=i||y!=j){var columnIdFrom=jexcel.getColumnNameFromId([x,y]);var columnIdTo=jexcel.getColumnNameFromId([i,j]);affectedTokens[columnIdFrom]=columnIdTo}};for(var j=0;j<obj.records.length;j++){for(var i=0;i<obj.records[0].length;i++){if(obj.records[j][i]){var x=obj.records[j][i].getAttribute("data-x");var y=obj.records[j][i].getAttribute("data-y");if(obj.records[j][i].getAttribute("data-merged")){var columnIdFrom=jexcel.getColumnNameFromId([x,y]);var columnIdTo=jexcel.getColumnNameFromId([i,j]);if(mergeCellUpdates[columnIdFrom]==null){if(columnIdFrom==columnIdTo){mergeCellUpdates[columnIdFrom]=false}else{var totalX=parseInt(i-x);var totalY=parseInt(j-y);mergeCellUpdates[columnIdFrom]=[columnIdTo,totalX,totalY]}}}else{updatePosition(x,y,i,j)}}}}var keys=Object.keys(mergeCellUpdates);if(keys.length){for(var i=0;i<keys.length;i++){if(mergeCellUpdates[keys[i]]){var info=jexcel.getIdFromColumnName(keys[i],true);var x=info[0];var y=info[1];updatePosition(x,y,x+mergeCellUpdates[keys[i]][1],y+mergeCellUpdates[keys[i]][2]);var columnIdFrom=keys[i];var columnIdTo=mergeCellUpdates[keys[i]][0];for(var j=0;j<obj.options.mergeCells[columnIdFrom][2].length;j++){var x=parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute("data-x"));var y=parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute("data-y"));obj.options.mergeCells[columnIdFrom][2][j].setAttribute("data-x",x+mergeCellUpdates[keys[i]][1]);obj.options.mergeCells[columnIdFrom][2][j].setAttribute("data-y",y+mergeCellUpdates[keys[i]][2])}obj.options.mergeCells[columnIdTo]=obj.options.mergeCells[columnIdFrom];delete (obj.options.mergeCells[columnIdFrom])}}}obj.updateFormulas(affectedTokens);obj.updateMeta(affectedTokens);obj.refreshSelection();obj.updateTable()};obj.updateTable=function(){if(obj.options.minSpareRows>0){var numBlankRows=0;for(var j=obj.rows.length-1;j>=0;j--){var test=false;for(var i=0;i<obj.headers.length;i++){if(obj.options.data[j][i]){test=true}}if(test){break}else{numBlankRows++}}if(obj.options.minSpareRows-numBlankRows>0){obj.insertRow(obj.options.minSpareRows-numBlankRows)}}if(obj.options.minSpareCols>0){var numBlankCols=0;for(var i=obj.headers.length-1;i>=0;i--){var test=false;for(var j=0;j<obj.rows.length;j++){if(obj.options.data[j][i]){test=true}}if(test){break}else{numBlankCols++}}if(obj.options.minSpareCols-numBlankCols>0){obj.insertColumn(obj.options.minSpareCols-numBlankCols)}}if(typeof(obj.options.updateTable)=="function"){if(obj.options.detachForUpdates){el.removeChild(obj.content)}for(var j=0;j<obj.rows.length;j++){for(var i=0;i<obj.headers.length;i++){obj.options.updateTable(el,obj.records[j][i],i,j,obj.options.data[j][i],obj.records[j][i].innerText,jexcel.getColumnNameFromId([i,j]))}}if(obj.options.detachForUpdates){el.insertBefore(obj.content,obj.pagination)}}if(obj.options.footers){obj.setFooter()}setTimeout(function(){obj.updateCornerPosition()},0)};obj.isReadOnly=function(cell){if(cell=obj.getCell(cell)){return cell.classList.contains("readonly")?true:false}};obj.setReadOnly=function(cell,state){if(cell=obj.getCell(cell)){if(state){cell.classList.add("readonly")}else{cell.classList.remove("readonly")}}};obj.showRow=function(rowNumber){obj.rows[rowNumber].style.display=""};obj.hideRow=function(rowNumber){obj.rows[rowNumber].style.display="none"};obj.showColumn=function(colNumber){obj.headers[colNumber].style.display="";obj.colgroup[colNumber].style.display="";for(var j=0;j<obj.options.data.length;j++){obj.records[j][colNumber].style.display=""}};obj.hideColumn=function(colNumber){obj.headers[colNumber].style.display="none";obj.colgroup[colNumber].style.display="none";for(var j=0;j<obj.options.data.length;j++){obj.records[j][colNumber].style.display="none"}};obj.showIndex=function(){obj.table.classList.remove("jexcel_hidden_index")};obj.hideIndex=function(){obj.table.classList.add("jexcel_hidden_index")};var chainLoopProtection=[];obj.updateFormulaChain=function(x,y,records){var cellId=jexcel.getColumnNameFromId([x,y]);if(obj.formula[cellId]&&obj.formula[cellId].length>0){if(chainLoopProtection[cellId]){obj.records[y][x].innerHTML="#ERROR";obj.formula[cellId]=""}else{chainLoopProtection[cellId]=true;for(var i=0;i<obj.formula[cellId].length;i++){var cell=jexcel.getIdFromColumnName(obj.formula[cellId][i],true);var value=""+obj.options.data[cell[1]][cell[0]];if(value.substr(0,1)=="="){records.push(obj.updateCell(cell[0],cell[1],value,true))}else{Object.keys(obj.formula)[i]=null}obj.updateFormulaChain(cell[0],cell[1],records)}}}chainLoopProtection=[]};obj.updateFormulas=function(referencesToUpdate){for(var j=0;j<obj.options.data.length;j++){for(var i=0;i<obj.options.data[0].length;i++){var value=""+obj.options.data[j][i];if(value.substr(0,1)=="="){var newFormula=obj.updateFormula(value,referencesToUpdate);if(newFormula!=value){obj.options.data[j][i]=newFormula}}}}var formula=[];var keys=Object.keys(obj.formula);for(var j=0;j<keys.length;j++){var key=keys[j];var value=obj.formula[key];if(referencesToUpdate[key]){key=referencesToUpdate[key]}formula[key]=[];for(var i=0;i<value.length;i++){var letter=value[i];if(referencesToUpdate[letter]){letter=referencesToUpdate[letter]}formula[key].push(letter)}}obj.formula=formula};obj.updateFormula=function(formula,referencesToUpdate){var testLetter=/[A-Z]/;var testNumber=/[0-9]/;var newFormula="";var letter=null;var number=null;var token="";for(var index=0;index<formula.length;index++){if(testLetter.exec(formula[index])){letter=1;number=0;token+=formula[index]}else{if(testNumber.exec(formula[index])){number=letter?1:0;token+=formula[index]}else{if(letter&&number){token=referencesToUpdate[token]?referencesToUpdate[token]:token}newFormula+=token;newFormula+=formula[index];letter=0;number=0;token=""}}}if(token){if(letter&&number){token=referencesToUpdate[token]?referencesToUpdate[token]:token}newFormula+=token}return newFormula};var secureFormula=function(oldValue){var newValue="";var inside=0;for(var i=0;i<oldValue.length;i++){if(oldValue[i]=='"'){if(inside==0){inside=1}else{inside=0}}if(inside==1){newValue+=oldValue[i]}else{newValue+=oldValue[i].toUpperCase()}}return newValue};obj.executeFormula=function(expression,x,y){var formulaResults=[];var formulaLoopProtection=[];var execute=function(expression,x,y){var parentId=jexcel.getColumnNameFromId([x,y]);if(formulaLoopProtection[parentId]){console.error("Reference loop detected");return"#ERROR"}formulaLoopProtection[parentId]=true;var tokensUpdate=function(tokens){for(var index=0;index<tokens.length;index++){var f=[];var token=tokens[index].split(":");var e1=jexcel.getIdFromColumnName(token[0],true);var e2=jexcel.getIdFromColumnName(token[1],true);if(e1[0]<=e2[0]){var x1=e1[0];var x2=e2[0]}else{var x1=e2[0];var x2=e1[0]}if(e1[1]<=e2[1]){var y1=e1[1];var y2=e2[1]}else{var y1=e2[1];var y2=e1[1]}for(var j=y1;j<=y2;j++){for(var i=x1;i<=x2;i++){f.push(jexcel.getColumnNameFromId([i,j]))}}expression=expression.replace(tokens[index],f.join(","))}};expression=expression.replace(/\$?([A-Z]+)\$?([0-9]+)/g,"$1$2");var tokens=expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);if(tokens&&tokens.length){tokensUpdate(tokens)}var tokens=expression.match(/([A-Z]+[0-9]+)/g);if(tokens&&tokens.indexOf(parentId)>-1){console.error("Self Reference detected");return"#ERROR"}else{var formulaExpressions={};if(tokens){for(var i=0;i<tokens.length;i++){if(!obj.formula[tokens[i]]){obj.formula[tokens[i]]=[]}if(obj.formula[tokens[i]].indexOf(parentId)<0){obj.formula[tokens[i]].push(parentId)}if(eval("typeof("+tokens[i]+') == "undefined"')){var position=jexcel.getIdFromColumnName(tokens[i],1);if(typeof(obj.options.data[position[1]])!="undefined"&&typeof(obj.options.data[position[1]][position[0]])!="undefined"){var value=obj.options.data[position[1]][position[0]]}else{var value=""}if((""+value).substr(0,1)=="="){if(formulaResults[tokens[i]]){value=formulaResults[tokens[i]]}else{value=execute(value,position[0],position[1]);formulaResults[tokens[i]]=value}}if((""+value).trim()==""){formulaExpressions[tokens[i]]=null}else{if(value==Number(value)&&obj.options.autoCasting==true){formulaExpressions[tokens[i]]=Number(value)}else{var number=obj.parseNumber(value,position[0]);if(obj.options.autoCasting==true&&number){formulaExpressions[tokens[i]]=number}else{formulaExpressions[tokens[i]]='"'+value+'"'}}}}}}try{var res=jexcel.formula(expression.substr(1),formulaExpressions,x,y,obj)}catch(e){var res="#ERROR";console.log(e)}return res}};return execute(expression,x,y)};obj.parseNumber=function(value,columnNumber){var decimal=columnNumber&&obj.options.columns[columnNumber].decimal?obj.options.columns[columnNumber].decimal:".";var number=(""+value);number=number.split(decimal);number[0]=number[0].match(/[+-]?[0-9]/g);if(number[0]){number[0]=number[0].join("")}if(number[1]){number[1]=number[1].match(/[0-9]*/g).join("")}if(number[0]&&Number(number[0])>=0){if(!number[1]){var value=Number(number[0]+".00")}else{var value=Number(number[0]+"."+number[1])}}else{var value=null}return value};obj.row=function(cell){};obj.col=function(cell){};obj.up=function(shiftKey,ctrlKey){if(shiftKey){if(obj.selectedCell[3]>0){obj.up.visible(1,ctrlKey?0:1)}}else{if(obj.selectedCell[1]>0){obj.up.visible(0,ctrlKey?0:1)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);if(obj.options.lazyLoading==true){if(obj.selectedCell[1]==0||obj.selectedCell[3]==0){obj.loadPage(0);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}else{if(obj.loadValidation()){obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}else{var item=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(obj.selectedCell[1]-item<30){obj.loadUp();obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}}}}else{if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);if(pageNumber!=obj.pageNumber){obj.page(pageNumber)}}}obj.updateScroll(1)};obj.up.visible=function(group,direction){if(group==0){var x=parseInt(obj.selectedCell[0]);var y=parseInt(obj.selectedCell[1])}else{var x=parseInt(obj.selectedCell[2]);var y=parseInt(obj.selectedCell[3])}if(direction==0){for(var j=0;j<y;j++){if(obj.records[j][x].style.display!="none"&&obj.rows[j].style.display!="none"){y=j;break}}}else{y=obj.up.get(x,y)}if(group==0){obj.selectedCell[0]=x;obj.selectedCell[1]=y}else{obj.selectedCell[2]=x;obj.selectedCell[3]=y}};obj.up.get=function(x,y){var x=parseInt(x);var y=parseInt(y);for(var j=(y-1);j>=0;j--){if(obj.records[j][x].style.display!="none"&&obj.rows[j].style.display!="none"){if(obj.records[j][x].getAttribute("data-merged")){if(obj.records[j][x]==obj.records[y][x]){continue}}y=j;break}}return y};obj.down=function(shiftKey,ctrlKey){if(shiftKey){if(obj.selectedCell[3]<obj.records.length-1){obj.down.visible(1,ctrlKey?0:1)}}else{if(obj.selectedCell[1]<obj.records.length-1){obj.down.visible(0,ctrlKey?0:1)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);if(obj.options.lazyLoading==true){if((obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1)){obj.loadPage(-1);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}else{if(obj.loadValidation()){obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}else{var item=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(item-obj.selectedCell[3]<30){obj.loadDown();obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])}}}}else{if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);if(pageNumber!=obj.pageNumber){obj.page(pageNumber)}}}obj.updateScroll(3)};obj.down.visible=function(group,direction){if(group==0){var x=parseInt(obj.selectedCell[0]);var y=parseInt(obj.selectedCell[1])}else{var x=parseInt(obj.selectedCell[2]);var y=parseInt(obj.selectedCell[3])}if(direction==0){for(var j=obj.rows.length-1;j>y;j--){if(obj.records[j][x].style.display!="none"&&obj.rows[j].style.display!="none"){y=j;break}}}else{y=obj.down.get(x,y)}if(group==0){obj.selectedCell[0]=x;obj.selectedCell[1]=y}else{obj.selectedCell[2]=x;obj.selectedCell[3]=y}};obj.down.get=function(x,y){var x=parseInt(x);var y=parseInt(y);for(var j=(y+1);j<obj.rows.length;j++){if(obj.records[j][x].style.display!="none"&&obj.rows[j].style.display!="none"){if(obj.records[j][x].getAttribute("data-merged")){if(obj.records[j][x]==obj.records[y][x]){continue}}y=j;break}}return y};obj.right=function(shiftKey,ctrlKey){if(shiftKey){if(obj.selectedCell[2]<obj.headers.length-1){obj.right.visible(1,ctrlKey?0:1)}}else{if(obj.selectedCell[0]<obj.headers.length-1){obj.right.visible(0,ctrlKey?0:1)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);obj.updateScroll(2)};obj.right.visible=function(group,direction){if(group==0){var x=parseInt(obj.selectedCell[0]);var y=parseInt(obj.selectedCell[1])}else{var x=parseInt(obj.selectedCell[2]);var y=parseInt(obj.selectedCell[3])}if(direction==0){for(var i=obj.headers.length-1;i>x;i--){if(obj.records[y][i].style.display!="none"){x=i;break}}}else{x=obj.right.get(x,y)}if(group==0){obj.selectedCell[0]=x;obj.selectedCell[1]=y}else{obj.selectedCell[2]=x;obj.selectedCell[3]=y}};obj.right.get=function(x,y){var x=parseInt(x);var y=parseInt(y);for(var i=(x+1);i<obj.headers.length;i++){if(obj.records[y][i].style.display!="none"){if(obj.records[y][i].getAttribute("data-merged")){if(obj.records[y][i]==obj.records[y][x]){continue}}x=i;break}}return x};obj.left=function(shiftKey,ctrlKey){if(shiftKey){if(obj.selectedCell[2]>0){obj.left.visible(1,ctrlKey?0:1)}}else{if(obj.selectedCell[0]>0){obj.left.visible(0,ctrlKey?0:1)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);obj.updateScroll(0)};obj.left.visible=function(group,direction){if(group==0){var x=parseInt(obj.selectedCell[0]);var y=parseInt(obj.selectedCell[1])}else{var x=parseInt(obj.selectedCell[2]);var y=parseInt(obj.selectedCell[3])}if(direction==0){for(var i=0;i<x;i++){if(obj.records[y][i].style.display!="none"){x=i;break}}}else{x=obj.left.get(x,y)}if(group==0){obj.selectedCell[0]=x;obj.selectedCell[1]=y}else{obj.selectedCell[2]=x;obj.selectedCell[3]=y}};obj.left.get=function(x,y){var x=parseInt(x);var y=parseInt(y);for(var i=(x-1);i>=0;i--){if(obj.records[y][i].style.display!="none"){if(obj.records[y][i].getAttribute("data-merged")){if(obj.records[y][i]==obj.records[y][x]){continue}}x=i;break}}return x};obj.first=function(shiftKey,ctrlKey){if(shiftKey){if(ctrlKey){obj.selectedCell[3]=0}else{obj.left.visible(1,0)}}else{if(ctrlKey){obj.selectedCell[1]=0}else{obj.left.visible(0,0)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}if(obj.options.lazyLoading==true&&(obj.selectedCell[1]==0||obj.selectedCell[3]==0)){obj.loadPage(0)}else{if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);if(pageNumber!=obj.pageNumber){obj.page(pageNumber)}}}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);obj.updateScroll(1)};obj.last=function(shiftKey,ctrlKey){if(shiftKey){if(ctrlKey){obj.selectedCell[3]=obj.records.length-1}else{obj.right.visible(1,0)}}else{if(ctrlKey){obj.selectedCell[1]=obj.records.length-1}else{obj.right.visible(0,0)}obj.selectedCell[2]=obj.selectedCell[0];obj.selectedCell[3]=obj.selectedCell[1]}if(obj.options.lazyLoading==true&&(obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1)){obj.loadPage(-1)}else{if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);if(pageNumber!=obj.pageNumber){obj.page(pageNumber)}}}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);obj.updateScroll(3)};obj.selectAll=function(){if(!obj.selectedCell){obj.selectedCell=[]}obj.selectedCell[0]=0;obj.selectedCell[1]=0;obj.selectedCell[2]=obj.headers.length-1;obj.selectedCell[3]=obj.records.length-1;obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])};obj.loadPage=function(pageNumber){if(obj.options.search==true&&obj.results){var results=obj.results}else{var results=obj.rows}var quantityPerPage=100;if(pageNumber==null||pageNumber==-1){pageNumber=Math.ceil(results.length/quantityPerPage)-1}var startRow=(pageNumber*quantityPerPage);var finalRow=(pageNumber*quantityPerPage)+quantityPerPage;if(finalRow>results.length){finalRow=results.length}startRow=finalRow-100;if(startRow<0){startRow=0}for(var j=startRow;j<finalRow;j++){if(obj.options.search==true&&obj.results){obj.tbody.appendChild(obj.rows[results[j]])}else{obj.tbody.appendChild(obj.rows[j])}if(obj.tbody.children.length>quantityPerPage){obj.tbody.removeChild(obj.tbody.firstChild)}}};obj.loadUp=function(){if(obj.options.search==true&&obj.results){var results=obj.results}else{var results=obj.rows}var test=0;if(results.length>100){var item=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(obj.options.search==true&&obj.results){item=results.indexOf(item)}if(item>0){for(var j=0;j<30;j++){item=item-1;if(item>-1){if(obj.options.search==true&&obj.results){obj.tbody.insertBefore(obj.rows[results[item]],obj.tbody.firstChild)}else{obj.tbody.insertBefore(obj.rows[item],obj.tbody.firstChild)}if(obj.tbody.children.length>100){obj.tbody.removeChild(obj.tbody.lastChild);test=1}}}}}return test};obj.loadDown=function(){if(obj.options.search==true&&obj.results){var results=obj.results}else{var results=obj.rows}var test=0;if(results.length>100){var item=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(obj.options.search==true&&obj.results){item=results.indexOf(item)}if(item<obj.rows.length-1){for(var j=0;j<=30;j++){if(item<results.length){if(obj.options.search==true&&obj.results){obj.tbody.appendChild(obj.rows[results[item]])}else{obj.tbody.appendChild(obj.rows[item])}if(obj.tbody.children.length>100){obj.tbody.removeChild(obj.tbody.firstChild);test=1}}item=item+1}}}return test};obj.loadValidation=function(){if(obj.selectedCell){var currentPage=parseInt(obj.tbody.firstChild.getAttribute("data-y"))/100;var selectedPage=parseInt(obj.selectedCell[3]/100);var totalPages=parseInt(obj.rows.length/100);if(currentPage!=selectedPage&&selectedPage<=totalPages){if(!Array.prototype.indexOf.call(obj.tbody.children,obj.rows[obj.selectedCell[3]])){obj.loadPage(selectedPage);return true}}}return false};obj.resetSearch=function(){obj.searchInput.value="";obj.search("");obj.results=null};obj.search=function(query){if(query){var query=query.toLowerCase()}if(obj.options.filters){obj.resetFilters()}obj.resetSelection();obj.pageNumber=0;obj.results=[];if(query){var search=function(item,query,index){for(var i=0;i<item.length;i++){if((""+item[i]).toLowerCase().search(query)>=0||(""+obj.records[index][i].innerHTML).toLowerCase().search(query)>=0){return true}}return false};var addToResult=function(k){if(obj.results.indexOf(k)==-1){obj.results.push(k)}};var data=obj.options.data.filter(function(v,k){if(search(v,query,k)){var rows=obj.isRowMerged(k);if(rows.length){for(var i=0;i<rows.length;i++){var row=jexcel.getIdFromColumnName(rows[i],true);for(var j=0;j<obj.options.mergeCells[rows[i]][1];j++){addToResult(row[1]+j)}}}else{addToResult(k)}return true}else{return false}})}else{obj.results=null}return obj.updateResult()};obj.updateResult=function(){var total=0;var index=0;if(obj.options.lazyLoading==true){total=100}else{if(obj.options.pagination>0){total=obj.options.pagination}else{if(obj.results){total=obj.results.length}else{total=obj.rows.length}}}while(obj.tbody.firstChild){obj.tbody.removeChild(obj.tbody.firstChild)}for(var j=0;j<obj.rows.length;j++){if(!obj.results||obj.results.indexOf(j)>-1){if(index<total){obj.tbody.appendChild(obj.rows[j]);index++}obj.rows[j].style.display=""}else{obj.rows[j].style.display="none"}}if(obj.options.pagination>0){obj.updatePagination()}obj.updateCornerPosition();return total};obj.whichPage=function(cell){if(obj.options.search==true&&obj.results){cell=obj.results.indexOf(cell)}return(Math.ceil((parseInt(cell)+1)/parseInt(obj.options.pagination)))-1};obj.page=function(pageNumber){var oldPage=obj.pageNumber;if(obj.options.search==true&&obj.results){var results=obj.results}else{var results=obj.rows}var quantityPerPage=parseInt(obj.options.pagination);if(pageNumber==null||pageNumber==-1){pageNumber=Math.ceil(results.length/quantityPerPage)-1}obj.pageNumber=pageNumber;var startRow=(pageNumber*quantityPerPage);var finalRow=(pageNumber*quantityPerPage)+quantityPerPage;if(finalRow>results.length){finalRow=results.length}if(startRow<0){startRow=0}while(obj.tbody.firstChild){obj.tbody.removeChild(obj.tbody.firstChild)}for(var j=startRow;j<finalRow;j++){if(obj.options.search==true&&obj.results){obj.tbody.appendChild(obj.rows[results[j]])}else{obj.tbody.appendChild(obj.rows[j])}}if(obj.options.pagination>0){obj.updatePagination()}obj.updateCornerPosition();obj.dispatch("onchangepage",el,pageNumber,oldPage)};obj.updatePagination=function(){obj.pagination.children[0].innerHTML="";obj.pagination.children[1].innerHTML="";if(obj.options.pagination){if(obj.options.search==true&&obj.results){var results=obj.results.length}else{var results=obj.rows.length}if(!results){obj.pagination.children[0].innerHTML=obj.options.text.noRecordsFound}else{var quantyOfPages=Math.ceil(results/obj.options.pagination);if(obj.pageNumber<6){var startNumber=1;var finalNumber=quantyOfPages<10?quantyOfPages:10}else{if(quantyOfPages-obj.pageNumber<5){var startNumber=quantyOfPages-9;var finalNumber=quantyOfPages;if(startNumber<1){startNumber=1}}else{var startNumber=obj.pageNumber-4;var finalNumber=obj.pageNumber+5}}if(startNumber>1){var paginationItem=document.createElement("div");paginationItem.className="jexcel_page";paginationItem.innerHTML="<";paginationItem.title=1;obj.pagination.children[1].appendChild(paginationItem)}for(var i=startNumber;i<=finalNumber;i++){var paginationItem=document.createElement("div");paginationItem.className="jexcel_page";paginationItem.innerHTML=i;obj.pagination.children[1].appendChild(paginationItem);if(obj.pageNumber==(i-1)){paginationItem.classList.add("jexcel_page_selected")}}if(finalNumber<quantyOfPages){var paginationItem=document.createElement("div");paginationItem.className="jexcel_page";paginationItem.innerHTML=">";paginationItem.title=quantyOfPages;obj.pagination.children[1].appendChild(paginationItem)}var format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})};obj.pagination.children[0].innerHTML=format(obj.options.text.showingPage,obj.pageNumber+1,quantyOfPages)}}};obj.download=function(includeHeaders){if(obj.options.allowExport==false){console.error("Export not allowed")}else{var data="";data+=obj.copy(false,obj.options.csvDelimiter,true,includeHeaders,true);var blob=new Blob(["\uFEFF"+data],{type:"text/csv;charset=utf-8;"});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(blob,obj.options.csvFileName+".csv")}else{var pom=document.createElement("a");var url=URL.createObjectURL(blob);pom.href=url;pom.setAttribute("download",obj.options.csvFileName+".csv");document.body.appendChild(pom);pom.click();pom.parentNode.removeChild(pom)}}};obj.setHistory=function(changes){if(obj.ignoreHistory!=true){var index=++obj.historyIndex;obj.history=(obj.history=obj.history.slice(0,index+1));obj.history[index]=changes}};obj.copy=function(highlighted,delimiter,returnData,includeHeaders,download){if(!delimiter){delimiter="\t"}var div=new RegExp(delimiter,"ig");var header=[];var col=[];var colLabel=[];var row=[];var rowLabel=[];var x=obj.options.data[0].length;var y=obj.options.data.length;var tmp="";var copyHeader=false;var headers="";var nestedHeaders="";var numOfCols=0;var numOfRows=0;if((download&&obj.options.includeHeadersOnDownload==true)||(!download&&obj.options.includeHeadersOnCopy==true)||(includeHeaders)){if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(!(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])){tmp=[obj.options.nestedHeaders]}else{tmp=obj.options.nestedHeaders}for(var j=0;j<tmp.length;j++){var nested=[];for(var i=0;i<tmp[j].length;i++){var colspan=parseInt(tmp[j][i].colspan);nested.push(tmp[j][i].title);for(var c=0;c<colspan-1;c++){nested.push("")}}nestedHeaders+=nested.join(delimiter)+"\r\n"}}copyHeader=true}obj.style=[];for(var j=0;j<y;j++){col=[];colLabel=[];for(var i=0;i<x;i++){if(!highlighted||obj.records[j][i].classList.contains("highlight")){if(copyHeader==true){header.push(obj.headers[i].innerText)}var value=obj.options.data[j][i];if(value.match&&(value.match(div)||value.match(/,/g)||value.match(/\n/)||value.match(/\"/))){value=value.replace(new RegExp('"',"g"),'""');value='"'+value+'"'}col.push(value);if(obj.options.columns[i].type=="checkbox"||obj.options.columns[i].type=="radio"){var label=value}else{if(obj.options.stripHTMLOnCopy==true){var label=obj.records[j][i].innerText}else{var label=obj.records[j][i].innerHTML}if(label.match&&(label.match(div)||label.match(/,/g)||label.match(/\n/)||label.match(/\"/))){label=label.replace(new RegExp('"',"g"),'""');label='"'+label+'"'}}colLabel.push(label);tmp=obj.records[j][i].getAttribute("style");tmp=tmp.replace("display: none;","");obj.style.push(tmp?tmp:"")}}if(col.length){if(copyHeader){numOfCols=col.length;row.push(header.join(delimiter))}row.push(col.join(delimiter))}if(colLabel.length){numOfRows++;if(copyHeader){rowLabel.push(header.join(delimiter));copyHeader=false}rowLabel.push(colLabel.join(delimiter))}}if(x==numOfCols&&y==numOfRows){headers=nestedHeaders}var str=headers+row.join("\r\n");var strLabel=headers+rowLabel.join("\r\n");if(!returnData){if(obj.options.copyCompatibility==true){obj.textarea.value=strLabel}else{obj.textarea.value=str}obj.textarea.select();document.execCommand("copy")}if(obj.options.copyCompatibility==true){obj.data=strLabel}else{obj.data=str}obj.hashString=obj.hash(obj.data);if(!returnData){obj.removeCopyingSelection();if(obj.highlighted){for(var i=0;i<obj.highlighted.length;i++){obj.highlighted[i].classList.add("copying");if(obj.highlighted[i].classList.contains("highlight-left")){obj.highlighted[i].classList.add("copying-left")}if(obj.highlighted[i].classList.contains("highlight-right")){obj.highlighted[i].classList.add("copying-right")}if(obj.highlighted[i].classList.contains("highlight-top")){obj.highlighted[i].classList.add("copying-top")}if(obj.highlighted[i].classList.contains("highlight-bottom")){obj.highlighted[i].classList.add("copying-bottom")}}}obj.dispatch("oncopy",el,obj.options.copyCompatibility==true?rowLabel:row,obj.hashString)}return obj.data};obj.paste=function(selectedCell,data){var x=selectedCell[0],y=selectedCell[1],w=selectedCell[2]-x+1,h=selectedCell[3]-y+1;if(selectedCell[2]<selectedCell[0]){x=selectedCell[2];w=selectedCell[0]-x+1}if(selectedCell[3]<selectedCell[1]){y=selectedCell[3];h=selectedCell[1]-y+1}var ret=obj.dispatch("onbeforepaste",el,data,x,y);if(ret===false){return false}else{if(ret){var data=ret}}var hash=obj.hash(data);var style=(hash==obj.hashString)?obj.style:null;if(obj.options.copyCompatibility==true&&hash==obj.hashString){var data=obj.data}var data=obj.parseCSV(data,"\t");if(w>1&Number.isInteger(w/data[0].length)){style=null;repeats=w/data[0].length;var arrayB=data.map(function(row,i){var arrayC=Array.apply(null,{length:repeats*row.length}).map(function(e,i){return row[i%row.length]});return arrayC});data=arrayB}if(h>1&Number.isInteger(h/data.length)){style=null;var repeats=h/data.length;var arrayB=Array.apply(null,{length:repeats*data.length}).map(function(e,i){return data[i%data.length]});data=arrayB}if(x!=null&&y!=null&&data){var i=0;var j=0;var records=[];var newStyle={};var oldStyle={};var styleIndex=0;var colIndex=parseInt(x);var rowIndex=parseInt(y);var row=null;while(row=data[j]){i=0;colIndex=parseInt(x);while(row[i]!=null){var record=obj.updateCell(colIndex,rowIndex,row[i]);records.push(record);obj.updateFormulaChain(colIndex,rowIndex,records);if(style&&style[styleIndex]){var columnName=jexcel.getColumnNameFromId([colIndex,rowIndex]);newStyle[columnName]=style[styleIndex];oldStyle[columnName]=obj.getStyle(columnName);obj.records[rowIndex][colIndex].setAttribute("style",style[styleIndex]);styleIndex++}i++;if(row[i]!=null){if(colIndex>=obj.headers.length-1){if(obj.options.allowInsertColumn==true){obj.insertColumn()}else{break}}colIndex=obj.right.get(colIndex,rowIndex)}}j++;if(data[j]){if(rowIndex>=obj.rows.length-1){if(obj.options.allowInsertRow==true){obj.insertRow()}else{break}}rowIndex=obj.down.get(x,rowIndex)}}obj.updateSelectionFromCoords(x,y,colIndex,rowIndex);obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell,newStyle:newStyle,oldStyle:oldStyle});obj.updateTable();obj.dispatch("onpaste",el,data);obj.onafterchanges(el,records)}obj.removeCopyingSelection()};obj.removeCopyingSelection=function(){var copying=document.querySelectorAll(".jexcel .copying");for(var i=0;i<copying.length;i++){copying[i].classList.remove("copying");copying[i].classList.remove("copying-left");copying[i].classList.remove("copying-right");copying[i].classList.remove("copying-top");copying[i].classList.remove("copying-bottom")}};obj.historyProcessRow=function(type,historyRecord){var rowIndex=(!historyRecord.insertBefore)?historyRecord.rowNumber+1:+historyRecord.rowNumber;if(obj.options.search==true){if(obj.results&&obj.results.length!=obj.rows.length){obj.resetSearch()}}if(type==1){var numOfRows=historyRecord.numOfRows;for(var j=rowIndex;j<(numOfRows+rowIndex);j++){obj.rows[j].parentNode.removeChild(obj.rows[j])}obj.records.splice(rowIndex,numOfRows);obj.options.data.splice(rowIndex,numOfRows);obj.rows.splice(rowIndex,numOfRows);obj.conditionalSelectionUpdate(1,rowIndex,(numOfRows+rowIndex)-1)}else{obj.records=jexcel.injectArray(obj.records,rowIndex,historyRecord.rowRecords);obj.options.data=jexcel.injectArray(obj.options.data,rowIndex,historyRecord.rowData);obj.rows=jexcel.injectArray(obj.rows,rowIndex,historyRecord.rowNode);var index=0;for(var j=rowIndex;j<(historyRecord.numOfRows+rowIndex);j++){obj.tbody.insertBefore(historyRecord.rowNode[index],obj.tbody.children[j]);index++}}if(obj.options.pagination>0){obj.page(obj.pageNumber)}obj.updateTableReferences()};obj.historyProcessColumn=function(type,historyRecord){var columnIndex=(!historyRecord.insertBefore)?historyRecord.columnNumber+1:historyRecord.columnNumber;if(type==1){var numOfColumns=historyRecord.numOfColumns;obj.options.columns.splice(columnIndex,numOfColumns);for(var i=columnIndex;i<(numOfColumns+columnIndex);i++){obj.headers[i].parentNode.removeChild(obj.headers[i]);obj.colgroup[i].parentNode.removeChild(obj.colgroup[i])}obj.headers.splice(columnIndex,numOfColumns);obj.colgroup.splice(columnIndex,numOfColumns);for(var j=0;j<historyRecord.data.length;j++){for(var i=columnIndex;i<(numOfColumns+columnIndex);i++){obj.records[j][i].parentNode.removeChild(obj.records[j][i])}obj.records[j].splice(columnIndex,numOfColumns);obj.options.data[j].splice(columnIndex,numOfColumns)}if(obj.options.footers){for(var j=0;j<obj.options.footers.length;j++){obj.options.footers[j].splice(columnIndex,numOfColumns)}}}else{obj.options.columns=jexcel.injectArray(obj.options.columns,columnIndex,historyRecord.columns);obj.headers=jexcel.injectArray(obj.headers,columnIndex,historyRecord.headers);obj.colgroup=jexcel.injectArray(obj.colgroup,columnIndex,historyRecord.colgroup);var index=0;for(var i=columnIndex;i<(historyRecord.numOfColumns+columnIndex);i++){obj.headerContainer.insertBefore(historyRecord.headers[index],obj.headerContainer.children[i+1]);obj.colgroupContainer.insertBefore(historyRecord.colgroup[index],obj.colgroupContainer.children[i+1]);index++}for(var j=0;j<historyRecord.data.length;j++){obj.options.data[j]=jexcel.injectArray(obj.options.data[j],columnIndex,historyRecord.data[j]);obj.records[j]=jexcel.injectArray(obj.records[j],columnIndex,historyRecord.records[j]);var index=0;for(var i=columnIndex;i<(historyRecord.numOfColumns+columnIndex);i++){obj.rows[j].insertBefore(historyRecord.records[j][index],obj.rows[j].children[i+1]);index++}}if(obj.options.footers){for(var j=0;j<obj.options.footers.length;j++){obj.options.footers[j]=jexcel.injectArray(obj.options.footers[j],columnIndex,historyRecord.footers[j])}}}if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]){for(var j=0;j<obj.options.nestedHeaders.length;j++){if(type==1){var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)-historyRecord.numOfColumns}else{var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)+historyRecord.numOfColumns}obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan;obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan)}}else{if(type==1){var colspan=parseInt(obj.options.nestedHeaders[0].colspan)-historyRecord.numOfColumns}else{var colspan=parseInt(obj.options.nestedHeaders[0].colspan)+historyRecord.numOfColumns}obj.options.nestedHeaders[0].colspan=colspan;obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}}obj.updateTableReferences()};obj.undo=function(){var ignoreEvents=obj.ignoreEvents?true:false;var ignoreHistory=obj.ignoreHistory?true:false;obj.ignoreEvents=true;obj.ignoreHistory=true;var records=[];if(obj.historyIndex>=0){var historyRecord=obj.history[obj.historyIndex--];if(historyRecord.action=="insertRow"){obj.historyProcessRow(1,historyRecord)}else{if(historyRecord.action=="deleteRow"){obj.historyProcessRow(0,historyRecord)}else{if(historyRecord.action=="insertColumn"){obj.historyProcessColumn(1,historyRecord)}else{if(historyRecord.action=="deleteColumn"){obj.historyProcessColumn(0,historyRecord)}else{if(historyRecord.action=="moveRow"){obj.moveRow(historyRecord.newValue,historyRecord.oldValue)}else{if(historyRecord.action=="moveColumn"){obj.moveColumn(historyRecord.newValue,historyRecord.oldValue)}else{if(historyRecord.action=="setMerge"){obj.removeMerge(historyRecord.column,historyRecord.data)}else{if(historyRecord.action=="setStyle"){obj.setStyle(historyRecord.oldValue,null,null,1)}else{if(historyRecord.action=="setWidth"){obj.setWidth(historyRecord.column,historyRecord.oldValue)}else{if(historyRecord.action=="setHeight"){obj.setHeight(historyRecord.row,historyRecord.oldValue)}else{if(historyRecord.action=="setHeader"){obj.setHeader(historyRecord.column,historyRecord.oldValue)}else{if(historyRecord.action=="setComments"){obj.setComments(historyRecord.column,historyRecord.oldValue[0],historyRecord.oldValue[1])}else{if(historyRecord.action=="orderBy"){var rows=[];for(var j=0;j<historyRecord.rows.length;j++){rows[historyRecord.rows[j]]=j}obj.updateOrderArrow(historyRecord.column,historyRecord.order?0:1);obj.updateOrder(rows)}else{if(historyRecord.action=="setValue"){for(var i=0;i<historyRecord.records.length;i++){records.push({x:historyRecord.records[i].x,y:historyRecord.records[i].y,newValue:historyRecord.records[i].oldValue});if(historyRecord.oldStyle){obj.resetStyle(historyRecord.oldStyle)}}obj.setValue(records);if(historyRecord.selection){obj.updateSelectionFromCoords(historyRecord.selection[0],historyRecord.selection[1],historyRecord.selection[2],historyRecord.selection[3])}}}}}}}}}}}}}}}}obj.ignoreEvents=ignoreEvents;obj.ignoreHistory=ignoreHistory;obj.dispatch("onundo",el,historyRecord)};obj.redo=function(){var ignoreEvents=obj.ignoreEvents?true:false;var ignoreHistory=obj.ignoreHistory?true:false;obj.ignoreEvents=true;obj.ignoreHistory=true;var records=[];if(obj.historyIndex<obj.history.length-1){var historyRecord=obj.history[++obj.historyIndex];if(historyRecord.action=="insertRow"){obj.historyProcessRow(0,historyRecord)}else{if(historyRecord.action=="deleteRow"){obj.historyProcessRow(1,historyRecord)}else{if(historyRecord.action=="insertColumn"){obj.historyProcessColumn(0,historyRecord)}else{if(historyRecord.action=="deleteColumn"){obj.historyProcessColumn(1,historyRecord)}else{if(historyRecord.action=="moveRow"){obj.moveRow(historyRecord.oldValue,historyRecord.newValue)}else{if(historyRecord.action=="moveColumn"){obj.moveColumn(historyRecord.oldValue,historyRecord.newValue)}else{if(historyRecord.action=="setMerge"){obj.setMerge(historyRecord.column,historyRecord.colspan,historyRecord.rowspan,1)}else{if(historyRecord.action=="setStyle"){obj.setStyle(historyRecord.newValue,null,null,1)}else{if(historyRecord.action=="setWidth"){obj.setWidth(historyRecord.column,historyRecord.newValue)}else{if(historyRecord.action=="setHeight"){obj.setHeight(historyRecord.row,historyRecord.newValue)}else{if(historyRecord.action=="setHeader"){obj.setHeader(historyRecord.column,historyRecord.newValue)}else{if(historyRecord.action=="setComments"){obj.setComments(historyRecord.column,historyRecord.newValue[0],historyRecord.newValue[1])}else{if(historyRecord.action=="orderBy"){obj.updateOrderArrow(historyRecord.column,historyRecord.order);obj.updateOrder(historyRecord.rows)}else{if(historyRecord.action=="setValue"){obj.setValue(historyRecord.records);for(var i=0;i<historyRecord.records.length;i++){if(historyRecord.oldStyle){obj.resetStyle(historyRecord.newStyle)}}if(historyRecord.selection){obj.updateSelectionFromCoords(historyRecord.selection[0],historyRecord.selection[1],historyRecord.selection[2],historyRecord.selection[3])}}}}}}}}}}}}}}}}obj.ignoreEvents=ignoreEvents;obj.ignoreHistory=ignoreHistory;obj.dispatch("onredo",el,historyRecord)};obj.getDropDownValue=function(column,key){var value=[];if(obj.options.columns[column]&&obj.options.columns[column].source){var combo=[];var source=obj.options.columns[column].source;for(var i=0;i<source.length;i++){if(typeof(source[i])=="object"){combo[source[i].id]=source[i].name}else{combo[source[i]]=source[i]}}var keys=Array.isArray(key)?key:(""+key).split(";");for(var i=0;i<keys.length;i++){if(typeof(keys[i])==="object"){value.push(combo[keys[i].id])}else{if(combo[keys[i]]){value.push(combo[keys[i]])}}}}else{console.error("Invalid column")}return(value.length>0)?value.join("; "):""};obj.parseCSV=function(str,delimiter){str=str.replace(/\r?\n$|\r$|\n$/g,"");if(str.charCodeAt(str.length-1)==9){str+="\0"}delimiter=(delimiter||",");var arr=[];var quote=false;for(var row=0,col=0,c=0;c<str.length;c++){var cc=str[c],nc=str[c+1];arr[row]=arr[row]||[];arr[row][col]=arr[row][col]||"";if(cc=='"'&&quote&&nc=='"'){arr[row][col]+=cc;++c;continue}if(cc=='"'){quote=!quote;continue}if(cc==delimiter&&!quote){++col;continue}if(cc=="\r"&&nc=="\n"&&!quote){++row;col=0;++c;continue}if(cc=="\n"&&!quote){++row;col=0;continue}if(cc=="\r"&&!quote){++row;col=0;continue}arr[row][col]+=cc}return arr};obj.hash=function(str){var hash=0,i,chr;if(str.length===0){return hash}else{for(i=0;i<str.length;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}}return hash};obj.onafterchanges=function(el,records){obj.dispatch("onafterchanges",el,records)};obj.destroy=function(){jexcel.destroy(el)};obj.init=function(){jexcel.current=obj;if(typeof(jexcel.build)=="function"){if(obj.options.root){jexcel.build(obj.options.root)}else{jexcel.build(document);jexcel.build=null}}el.setAttribute("tabindex",1);el.addEventListener("focus",function(e){if(jexcel.current&&!obj.selectedCell){obj.updateSelectionFromCoords(0,0,0,0);obj.left()}});if(obj.options.csv){if(obj.options.loadingSpin==true){jSuites.loading.show()}jSuites.ajax({url:obj.options.csv,method:obj.options.method,data:obj.options.requestVariables,dataType:"text",success:function(result){var newData=obj.parseCSV(result,obj.options.csvDelimiter);if(obj.options.csvHeaders==true&&newData.length>0){var headers=newData.shift();for(var i=0;i<headers.length;i++){if(!obj.options.columns[i]){obj.options.columns[i]={type:"text",align:obj.options.defaultColAlign,width:obj.options.defaultColWidth}}if(typeof obj.options.columns[i].title==="undefined"){obj.options.columns[i].title=headers[i]}}}obj.options.data=newData;obj.prepareTable();if(obj.options.loadingSpin==true){jSuites.loading.hide()}}})}else{if(obj.options.url){if(obj.options.loadingSpin==true){jSuites.loading.show()}jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(result){obj.options.data=(result.data)?result.data:result;obj.prepareTable();if(obj.options.loadingSpin==true){jSuites.loading.hide()}}})}else{obj.prepareTable()}}};if(options&&options.contextMenu!=null){obj.options.contextMenu=options.contextMenu}else{obj.options.contextMenu=function(el,x,y,e){var items=[];if(y==null){if(obj.options.allowInsertColumn==true){items.push({title:obj.options.text.insertANewColumnBefore,onclick:function(){obj.insertColumn(1,parseInt(x),1)}})}if(obj.options.allowInsertColumn==true){items.push({title:obj.options.text.insertANewColumnAfter,onclick:function(){obj.insertColumn(1,parseInt(x),0)}})}if(obj.options.allowDeleteColumn==true){items.push({title:obj.options.text.deleteSelectedColumns,onclick:function(){obj.deleteColumn(obj.getSelectedColumns().length?undefined:parseInt(x))}})}if(obj.options.allowRenameColumn==true){items.push({title:obj.options.text.renameThisColumn,onclick:function(){obj.setHeader(x)}})}if(obj.options.columnSorting==true){items.push({type:"line"});items.push({title:obj.options.text.orderAscending,onclick:function(){obj.orderBy(x,0)}});items.push({title:obj.options.text.orderDescending,onclick:function(){obj.orderBy(x,1)}})}}else{if(obj.options.allowInsertRow==true){items.push({title:obj.options.text.insertANewRowBefore,onclick:function(){obj.insertRow(1,parseInt(y),1)}});items.push({title:obj.options.text.insertANewRowAfter,onclick:function(){obj.insertRow(1,parseInt(y))}})}if(obj.options.allowDeleteRow==true){items.push({title:obj.options.text.deleteSelectedRows,onclick:function(){obj.deleteRow(obj.getSelectedRows().length?undefined:parseInt(y))}})}if(x){if(obj.options.allowComments==true){items.push({type:"line"});var title=obj.records[y][x].getAttribute("title")||"";items.push({title:title?obj.options.text.editComments:obj.options.text.addComments,onclick:function(){var comment=prompt(obj.options.text.comments,title);if(comment){obj.setComments([x,y],comment)}}});if(title){items.push({title:obj.options.text.clearComments,onclick:function(){obj.setComments([x,y],"")}})}}}}items.push({type:"line"});items.push({title:obj.options.text.copy,shortcut:"Ctrl + C",onclick:function(){obj.copy(true)}});if(navigator&&navigator.clipboard){items.push({title:obj.options.text.paste,shortcut:"Ctrl + V",onclick:function(){if(obj.selectedCell){navigator.clipboard.readText().then(function(text){if(text){jexcel.current.paste(obj.selectedCell,text)}})}}})}if(obj.options.allowExport){items.push({title:obj.options.text.saveAs,shortcut:"Ctrl + S",onclick:function(){obj.download()}})}if(obj.options.about){items.push({title:obj.options.text.about,onclick:function(){if(obj.options.about===true){alert(Version().print())}else{alert(obj.options.about)}}})}return items}}obj.scrollControls=function(e){obj.wheelControls();if(obj.options.freezeColumns>0&&obj.content.scrollLeft!=scrollLeft){obj.updateFreezePosition()}if(obj.options.lazyLoading==true||obj.options.tableOverflow==true){if(obj.edition&&e.target.className.substr(0,9)!="jdropdown"){obj.closeEditor(obj.edition[0],true)}}};obj.wheelControls=function(e){if(obj.options.lazyLoading==true){if(jexcel.timeControlLoading==null){jexcel.timeControlLoading=setTimeout(function(){if(obj.content.scrollTop+obj.content.clientHeight>=obj.content.scrollHeight-10){if(obj.loadDown()){if(obj.content.scrollTop+obj.content.clientHeight>obj.content.scrollHeight-10){obj.content.scrollTop=obj.content.scrollTop-obj.content.clientHeight}obj.updateCornerPosition()}}else{if(obj.content.scrollTop<=obj.content.clientHeight){if(obj.loadUp()){if(obj.content.scrollTop<10){obj.content.scrollTop=obj.content.scrollTop+obj.content.clientHeight}obj.updateCornerPosition()}}}jexcel.timeControlLoading=null},100)}}};obj.getFreezeWidth=function(){var width=0;if(obj.options.freezeColumns>0){for(var i=0;i<obj.options.freezeColumns;i++){width+=parseInt(obj.options.columns[i].width)}}return width};var scrollLeft=0;obj.updateFreezePosition=function(){scrollLeft=obj.content.scrollLeft;var width=0;if(scrollLeft>50){for(var i=0;i<obj.options.freezeColumns;i++){if(i>0){width+=parseInt(obj.options.columns[i-1].width)}obj.headers[i].classList.add("jexcel_freezed");obj.headers[i].style.left=width+"px";for(var j=0;j<obj.rows.length;j++){if(obj.rows[j]&&obj.records[j][i]){var shifted=(scrollLeft+(i>0?obj.records[j][i-1].style.width:0))-51+"px";obj.records[j][i].classList.add("jexcel_freezed");obj.records[j][i].style.left=shifted}}}}else{for(var i=0;i<obj.options.freezeColumns;i++){obj.headers[i].classList.remove("jexcel_freezed");obj.headers[i].style.left="";for(var j=0;j<obj.rows.length;j++){if(obj.records[j][i]){obj.records[j][i].classList.remove("jexcel_freezed");obj.records[j][i].style.left=""}}}}obj.updateCornerPosition()};el.addEventListener("DOMMouseScroll",obj.wheelControls);el.addEventListener("mousewheel",obj.wheelControls);el.jexcel=obj;el.jspreadsheet=obj;obj.init();return obj});jexcel.setDictionary=function(o){jSuites.setDictionary(o)};jexcel.setExtensions=function(o){var k=Object.keys(o);for(var i=0;i<k.length;i++){if(typeof(o[k[i]])==="function"){jexcel[k[i]]=o[k[i]];if(jexcel.license&&typeof(o[k[i]].license)=="function"){o[k[i]].license(jexcel.license)}}}};if(typeof(formula)!=="undefined"){jexcel.formula=formula}jexcel.version=Version;jexcel.current=null;jexcel.timeControl=null;jexcel.timeControlLoading=null;jexcel.destroy=function(element,destroyEventHandlers){if(element.jexcel){var root=element.jexcel.options.root?element.jexcel.options.root:document;element.removeEventListener("DOMMouseScroll",element.jexcel.scrollControls);element.removeEventListener("mousewheel",element.jexcel.scrollControls);element.jexcel=null;element.innerHTML="";if(destroyEventHandlers){root.removeEventListener("mouseup",jexcel.mouseUpControls);root.removeEventListener("mousedown",jexcel.mouseDownControls);root.removeEventListener("mousemove",jexcel.mouseMoveControls);root.removeEventListener("mouseover",jexcel.mouseOverControls);root.removeEventListener("dblclick",jexcel.doubleClickControls);root.removeEventListener("paste",jexcel.pasteControls);root.removeEventListener("contextmenu",jexcel.contextMenuControls);root.removeEventListener("touchstart",jexcel.touchStartControls);root.removeEventListener("touchend",jexcel.touchEndControls);root.removeEventListener("touchcancel",jexcel.touchEndControls);document.removeEventListener("keydown",jexcel.keyDownControls);jexcel=null}}};jexcel.build=function(root){root.addEventListener("mouseup",jexcel.mouseUpControls);root.addEventListener("mousedown",jexcel.mouseDownControls);root.addEventListener("mousemove",jexcel.mouseMoveControls);root.addEventListener("mouseover",jexcel.mouseOverControls);root.addEventListener("dblclick",jexcel.doubleClickControls);root.addEventListener("paste",jexcel.pasteControls);root.addEventListener("contextmenu",jexcel.contextMenuControls);root.addEventListener("touchstart",jexcel.touchStartControls);root.addEventListener("touchend",jexcel.touchEndControls);root.addEventListener("touchcancel",jexcel.touchEndControls);root.addEventListener("touchmove",jexcel.touchEndControls);document.addEventListener("keydown",jexcel.keyDownControls)};jexcel.keyDownControls=function(e){if(jexcel.current){if(jexcel.current.edition){if(e.which==27){if(jexcel.current.edition){jexcel.current.closeEditor(jexcel.current.edition[0],false)}e.preventDefault()}else{if(e.which==13){if(jexcel.current.options.columns[jexcel.current.edition[2]].type=="calendar"){jexcel.current.closeEditor(jexcel.current.edition[0],true)}else{if(jexcel.current.options.columns[jexcel.current.edition[2]].type=="dropdown"||jexcel.current.options.columns[jexcel.current.edition[2]].type=="autocomplete"){}else{if((jexcel.current.options.wordWrap==true||jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap==true||jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length>200)&&e.altKey){var editorTextarea=jexcel.current.edition[0].children[0];var editorValue=jexcel.current.edition[0].children[0].value;var editorIndexOf=editorTextarea.selectionStart;editorValue=editorValue.slice(0,editorIndexOf)+"\n"+editorValue.slice(editorIndexOf);editorTextarea.value=editorValue;editorTextarea.focus();editorTextarea.selectionStart=editorIndexOf+1;editorTextarea.selectionEnd=editorIndexOf+1}else{jexcel.current.edition[0].children[0].blur()}}}}else{if(e.which==9){if(jexcel.current.options.columns[jexcel.current.edition[2]].type=="calendar"){jexcel.current.closeEditor(jexcel.current.edition[0],true)}else{jexcel.current.edition[0].children[0].blur()}}}}}if(!jexcel.current.edition&&jexcel.current.selectedCell){if(e.which==37){jexcel.current.left(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==39){jexcel.current.right(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==38){jexcel.current.up(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==40){jexcel.current.down(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==36){jexcel.current.first(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==35){jexcel.current.last(e.shiftKey,e.ctrlKey);e.preventDefault()}else{if(e.which==32){if(jexcel.current.options.editable==true){jexcel.current.setCheckRadioValue()}e.preventDefault()}else{if(e.which==46){if(jexcel.current.options.editable==true){if(jexcel.current.selectedRow){if(jexcel.current.options.allowDeleteRow==true){if(confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)){jexcel.current.deleteRow()}}}else{if(jexcel.current.selectedHeader){if(jexcel.current.options.allowDeleteColumn==true){if(confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)){jexcel.current.deleteColumn()}}}else{jexcel.current.setValue(jexcel.current.highlighted,"")}}}}else{if(e.which==13){if(e.shiftKey){jexcel.current.up()}else{if(jexcel.current.options.allowInsertRow==true){if(jexcel.current.options.allowManualInsertRow==true){if(jexcel.current.selectedCell[1]==jexcel.current.options.data.length-1){jexcel.current.insertRow()}}}jexcel.current.down()}e.preventDefault()}else{if(e.which==9){if(e.shiftKey){jexcel.current.left()}else{if(jexcel.current.options.allowInsertColumn==true){if(jexcel.current.options.allowManualInsertColumn==true){if(jexcel.current.selectedCell[0]==jexcel.current.options.data[0].length-1){jexcel.current.insertColumn()}}}jexcel.current.right()}e.preventDefault()}else{if((e.ctrlKey||e.metaKey)&&!e.shiftKey){if(e.which==65){jexcel.current.selectAll();e.preventDefault()}else{if(e.which==83){jexcel.current.download();e.preventDefault()}else{if(e.which==89){jexcel.current.redo();e.preventDefault()}else{if(e.which==90){jexcel.current.undo();e.preventDefault()}else{if(e.which==67){jexcel.current.copy(true);e.preventDefault()}else{if(e.which==88){if(jexcel.current.options.editable==true){jexcel.cutControls()}else{jexcel.copyControls()}e.preventDefault()}else{if(e.which==86){jexcel.pasteControls()}}}}}}}}else{if(jexcel.current.selectedCell){if(jexcel.current.options.editable==true){var rowId=jexcel.current.selectedCell[1];var columnId=jexcel.current.selectedCell[0];if(jexcel.current.options.columns[columnId].type!="readonly"){if(e.keyCode==32){if(jexcel.current.options.columns[columnId].type=="checkbox"||jexcel.current.options.columns[columnId].type=="radio"){e.preventDefault()}else{jexcel.current.openEditor(jexcel.current.records[rowId][columnId],true)}}else{if(e.keyCode==113){jexcel.current.openEditor(jexcel.current.records[rowId][columnId],false)}else{if((e.keyCode==8)||(e.keyCode>=48&&e.keyCode<=57)||(e.keyCode>=96&&e.keyCode<=111)||(e.keyCode>=187&&e.keyCode<=190)||((String.fromCharCode(e.keyCode)==e.key||String.fromCharCode(e.keyCode).toLowerCase()==e.key.toLowerCase())&&jexcel.validLetter(String.fromCharCode(e.keyCode)))){jexcel.current.openEditor(jexcel.current.records[rowId][columnId],true);if(jexcel.current.options.columns[columnId].type=="calendar"){e.preventDefault()}}}}}}}}}}}}}}}}}}}else{if(e.target.classList.contains("jexcel_search")){if(jexcel.timeControl){clearTimeout(jexcel.timeControl)}jexcel.timeControl=setTimeout(function(){jexcel.current.search(e.target.value)},200)}}}};jexcel.isMouseAction=false;jexcel.mouseDownControls=function(e){e=e||window.event;if(e.buttons){var mouseButton=e.buttons}else{if(e.button){var mouseButton=e.button}else{var mouseButton=e.which}}var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]){if(jexcel.current!=jexcelTable[0].jexcel){if(jexcel.current){if(jexcel.current.edition){jexcel.current.closeEditor(jexcel.current.edition[0],true)}jexcel.current.resetSelection()}jexcel.current=jexcelTable[0].jexcel}}else{if(jexcel.current){if(jexcel.current.edition){jexcel.current.closeEditor(jexcel.current.edition[0],true)}jexcel.current.resetSelection(true);jexcel.current=null}}if(jexcel.current&&mouseButton==1){if(e.target.classList.contains("jexcel_selectall")){if(jexcel.current){jexcel.current.selectAll()}}else{if(e.target.classList.contains("jexcel_corner")){if(jexcel.current.options.editable==true){jexcel.current.selectedCorner=true}}else{if(jexcelTable[1]==1){var columnId=e.target.getAttribute("data-x");if(columnId){var info=e.target.getBoundingClientRect();if(jexcel.current.options.columnResize==true&&info.width-e.offsetX<6){jexcel.current.resizing={mousePosition:e.pageX,column:columnId,width:info.width};jexcel.current.headers[columnId].classList.add("resizing");for(var j=0;j<jexcel.current.records.length;j++){if(jexcel.current.records[j][columnId]){jexcel.current.records[j][columnId].classList.add("resizing")}}}else{if(jexcel.current.options.columnDrag==true&&info.height-e.offsetY<6){if(jexcel.current.isColMerged(columnId).length){console.error("Jspreadsheet: This column is part of a merged cell.")}else{jexcel.current.resetSelection();jexcel.current.dragging={element:e.target,column:columnId,destination:columnId};jexcel.current.headers[columnId].classList.add("dragging");for(var j=0;j<jexcel.current.records.length;j++){if(jexcel.current.records[j][columnId]){jexcel.current.records[j][columnId].classList.add("dragging")}}}}else{if(jexcel.current.selectedHeader&&(e.shiftKey||e.ctrlKey)){var o=jexcel.current.selectedHeader;var d=columnId}else{if(jexcel.current.selectedHeader==columnId&&jexcel.current.options.allowRenameColumn==true){jexcel.timeControl=setTimeout(function(){jexcel.current.setHeader(columnId)},800)}jexcel.current.selectedHeader=columnId;var o=columnId;var d=columnId}jexcel.current.updateSelectionFromCoords(o,0,d,jexcel.current.options.data.length-1)}}}else{if(e.target.parentNode.classList.contains("jexcel_nested")){if(e.target.getAttribute("data-column")){var column=e.target.getAttribute("data-column").split(",");var c1=parseInt(column[0]);var c2=parseInt(column[column.length-1])}else{var c1=0;var c2=jexcel.current.options.columns.length-1}jexcel.current.updateSelectionFromCoords(c1,0,c2,jexcel.current.options.data.length-1)}}}else{jexcel.current.selectedHeader=false}if(jexcelTable[1]==2){var rowId=e.target.getAttribute("data-y");if(e.target.classList.contains("jexcel_row")){var info=e.target.getBoundingClientRect();if(jexcel.current.options.rowResize==true&&info.height-e.offsetY<6){jexcel.current.resizing={element:e.target.parentNode,mousePosition:e.pageY,row:rowId,height:info.height};e.target.parentNode.classList.add("resizing")}else{if(jexcel.current.options.rowDrag==true&&info.width-e.offsetX<6){if(jexcel.current.isRowMerged(rowId).length){console.error("Jspreadsheet: This row is part of a merged cell")}else{if(jexcel.current.options.search==true&&jexcel.current.results){console.error("Jspreadsheet: Please clear your search before perform this action")}else{jexcel.current.resetSelection();jexcel.current.dragging={element:e.target.parentNode,row:rowId,destination:rowId};e.target.parentNode.classList.add("dragging")}}}else{if(jexcel.current.selectedRow&&(e.shiftKey||e.ctrlKey)){var o=jexcel.current.selectedRow;var d=rowId}else{jexcel.current.selectedRow=rowId;var o=rowId;var d=rowId}jexcel.current.updateSelectionFromCoords(0,o,jexcel.current.options.data[0].length-1,d)}}}else{if(e.target.classList.contains("jclose")&&e.target.clientWidth-e.offsetX<50&&e.offsetY<50){jexcel.current.closeEditor(jexcel.current.edition[0],true)}else{var getCellCoords=function(element){var x=element.getAttribute("data-x");var y=element.getAttribute("data-y");if(x&&y){return[x,y]}else{if(element.parentNode){return getCellCoords(element.parentNode)}}};var position=getCellCoords(e.target);if(position){var columnId=position[0];var rowId=position[1];if(jexcel.current.edition){if(jexcel.current.edition[2]!=columnId||jexcel.current.edition[3]!=rowId){jexcel.current.closeEditor(jexcel.current.edition[0],true)}}if(!jexcel.current.edition){if(e.shiftKey){jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],columnId,rowId)}else{jexcel.current.updateSelectionFromCoords(columnId,rowId)}}jexcel.current.selectedHeader=null;jexcel.current.selectedRow=null}}}}else{jexcel.current.selectedRow=false}if(e.target.classList.contains("jexcel_page")){if(e.target.innerText=="<"){jexcel.current.page(0)}else{if(e.target.innerText==">"){jexcel.current.page(e.target.getAttribute("title")-1)}else{jexcel.current.page(e.target.innerText-1)}}}}}if(jexcel.current.edition){jexcel.isMouseAction=false}else{jexcel.isMouseAction=true}}else{jexcel.isMouseAction=false}};jexcel.mouseUpControls=function(e){if(jexcel.current){if(jexcel.current.resizing){if(jexcel.current.resizing.column){var newWidth=jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute("width");var columns=jexcel.current.getSelectedColumns();if(columns.length>1){var currentWidth=[];for(var i=0;i<columns.length;i++){currentWidth.push(parseInt(jexcel.current.colgroup[columns[i]].getAttribute("width")))}var index=columns.indexOf(parseInt(jexcel.current.resizing.column));currentWidth[index]=jexcel.current.resizing.width;jexcel.current.setWidth(columns,newWidth,currentWidth)}else{jexcel.current.setWidth(jexcel.current.resizing.column,newWidth,jexcel.current.resizing.width)}jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");for(var j=0;j<jexcel.current.records.length;j++){if(jexcel.current.records[j][jexcel.current.resizing.column]){jexcel.current.records[j][jexcel.current.resizing.column].classList.remove("resizing")}}}else{jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove("resizing");var newHeight=jexcel.current.rows[jexcel.current.resizing.row].getAttribute("height");jexcel.current.setHeight(jexcel.current.resizing.row,newHeight,jexcel.current.resizing.height);jexcel.current.resizing.element.classList.remove("resizing")}jexcel.current.resizing=null}else{if(jexcel.current.dragging){if(jexcel.current.dragging){if(jexcel.current.dragging.column){var columnId=e.target.getAttribute("data-x");jexcel.current.headers[jexcel.current.dragging.column].classList.remove("dragging");for(var j=0;j<jexcel.current.rows.length;j++){if(jexcel.current.records[j][jexcel.current.dragging.column]){jexcel.current.records[j][jexcel.current.dragging.column].classList.remove("dragging")}}for(var i=0;i<jexcel.current.headers.length;i++){jexcel.current.headers[i].classList.remove("dragging-left");jexcel.current.headers[i].classList.remove("dragging-right")}if(columnId){if(jexcel.current.dragging.column!=jexcel.current.dragging.destination){jexcel.current.moveColumn(jexcel.current.dragging.column,jexcel.current.dragging.destination)}}}else{if(jexcel.current.dragging.element.nextSibling){var position=parseInt(jexcel.current.dragging.element.nextSibling.getAttribute("data-y"));if(jexcel.current.dragging.row<position){position-=1}}else{var position=parseInt(jexcel.current.dragging.element.previousSibling.getAttribute("data-y"))}if(jexcel.current.dragging.row!=jexcel.current.dragging.destination){jexcel.current.moveRow(jexcel.current.dragging.row,position,true)}jexcel.current.dragging.element.classList.remove("dragging")}jexcel.current.dragging=null}}else{if(jexcel.current.selectedCorner){jexcel.current.selectedCorner=false;if(jexcel.current.selection.length>0){jexcel.current.copyData(jexcel.current.selection[0],jexcel.current.selection[jexcel.current.selection.length-1]);jexcel.current.removeCopySelection()}}}}}if(jexcel.timeControl){clearTimeout(jexcel.timeControl);jexcel.timeControl=null}jexcel.isMouseAction=false};jexcel.mouseMoveControls=function(e){e=e||window.event;if(e.buttons){var mouseButton=e.buttons}else{if(e.button){var mouseButton=e.button}else{var mouseButton=e.which}}if(!mouseButton){jexcel.isMouseAction=false}if(jexcel.current){if(jexcel.isMouseAction==true){if(jexcel.current.resizing){if(jexcel.current.resizing.column){var width=e.pageX-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.width+width>0){var tempWidth=jexcel.current.resizing.width+width;jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute("width",tempWidth);jexcel.current.updateCornerPosition()}}else{var height=e.pageY-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.height+height>0){var tempHeight=jexcel.current.resizing.height+height;jexcel.current.rows[jexcel.current.resizing.row].setAttribute("height",tempHeight);jexcel.current.updateCornerPosition()}}}}else{var x=e.target.getAttribute("data-x");var y=e.target.getAttribute("data-y");var rect=e.target.getBoundingClientRect();if(jexcel.current.cursor){jexcel.current.cursor.style.cursor="";jexcel.current.cursor=null}if(e.target.parentNode.parentNode&&e.target.parentNode.parentNode.className){if(e.target.parentNode.parentNode.classList.contains("resizable")){if(e.target&&x&&!y&&(rect.width-(e.clientX-rect.left)<6)){jexcel.current.cursor=e.target;jexcel.current.cursor.style.cursor="col-resize"}else{if(e.target&&!x&&y&&(rect.height-(e.clientY-rect.top)<6)){jexcel.current.cursor=e.target;jexcel.current.cursor.style.cursor="row-resize"}}}if(e.target.parentNode.parentNode.classList.contains("draggable")){if(e.target&&!x&&y&&(rect.width-(e.clientX-rect.left)<6)){jexcel.current.cursor=e.target;jexcel.current.cursor.style.cursor="move"}else{if(e.target&&x&&!y&&(rect.height-(e.clientY-rect.top)<6)){jexcel.current.cursor=e.target;jexcel.current.cursor.style.cursor="move"}}}}}}};jexcel.mouseOverControls=function(e){e=e||window.event;if(e.buttons){var mouseButton=e.buttons}else{if(e.button){var mouseButton=e.button}else{var mouseButton=e.which}}if(!mouseButton){jexcel.isMouseAction=false}if(jexcel.current&&jexcel.isMouseAction==true){var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]){if(jexcel.current!=jexcelTable[0].jexcel){if(jexcel.current){return false}}var columnId=e.target.getAttribute("data-x");var rowId=e.target.getAttribute("data-y");if(jexcel.current.dragging){if(jexcel.current.dragging.column){if(columnId){if(jexcel.current.isColMerged(columnId).length){console.error("Jspreadsheet: This column is part of a merged cell.")}else{for(var i=0;i<jexcel.current.headers.length;i++){jexcel.current.headers[i].classList.remove("dragging-left");jexcel.current.headers[i].classList.remove("dragging-right")}if(jexcel.current.dragging.column==columnId){jexcel.current.dragging.destination=parseInt(columnId)}else{if(e.target.clientWidth/2>e.offsetX){if(jexcel.current.dragging.column<columnId){jexcel.current.dragging.destination=parseInt(columnId)-1}else{jexcel.current.dragging.destination=parseInt(columnId)}jexcel.current.headers[columnId].classList.add("dragging-left")}else{if(jexcel.current.dragging.column<columnId){jexcel.current.dragging.destination=parseInt(columnId)}else{jexcel.current.dragging.destination=parseInt(columnId)+1}jexcel.current.headers[columnId].classList.add("dragging-right")}}}}}else{if(rowId){if(jexcel.current.isRowMerged(rowId).length){console.error("Jspreadsheet: This row is part of a merged cell.")}else{var target=(e.target.clientHeight/2>e.offsetY)?e.target.parentNode.nextSibling:e.target.parentNode;if(jexcel.current.dragging.element!=target){e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element,target);jexcel.current.dragging.destination=Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children,jexcel.current.dragging.element)}}}}}else{if(jexcel.current.resizing){}else{if(jexcelTable[1]==1){if(jexcel.current.selectedHeader){var columnId=e.target.getAttribute("data-x");var o=jexcel.current.selectedHeader;var d=columnId;jexcel.current.updateSelectionFromCoords(o,0,d,jexcel.current.options.data.length-1)}}if(jexcelTable[1]==2){if(e.target.classList.contains("jexcel_row")){if(jexcel.current.selectedRow){var o=jexcel.current.selectedRow;var d=rowId;jexcel.current.updateSelectionFromCoords(0,o,jexcel.current.options.data[0].length-1,d)}}else{if(!jexcel.current.edition){if(columnId&&rowId){if(jexcel.current.selectedCorner){jexcel.current.updateCopySelection(columnId,rowId)}else{if(jexcel.current.selectedCell){jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],columnId,rowId)}}}}}}}}}}if(jexcel.timeControl){clearTimeout(jexcel.timeControl);jexcel.timeControl=null}};jexcel.doubleClickControls=function(e){if(jexcel.current){if(e.target.classList.contains("jexcel_corner")){if(jexcel.current.highlighted.length>0){var x1=jexcel.current.highlighted[0].getAttribute("data-x");var y1=parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-y"))+1;var x2=jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-x");var y2=jexcel.current.records.length-1;jexcel.current.copyData(jexcel.current.records[y1][x1],jexcel.current.records[y2][x2])}}else{if(e.target.classList.contains("jexcel_column_filter")){var columnId=e.target.getAttribute("data-x");jexcel.current.openFilter(columnId)}else{var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[1]==1&&jexcel.current.options.columnSorting==true){var columnId=e.target.getAttribute("data-x");if(columnId){jexcel.current.orderBy(columnId)}}if(jexcelTable[1]==2&&jexcel.current.options.editable==true){if(!jexcel.current.edition){var getCellCoords=function(element){if(element.parentNode){var x=element.getAttribute("data-x");var y=element.getAttribute("data-y");if(x&&y){return element}else{return getCellCoords(element.parentNode)}}};var cell=getCellCoords(e.target);if(cell&&cell.classList.contains("highlight")){jexcel.current.openEditor(cell)}}}}}}};jexcel.copyControls=function(e){if(jexcel.current&&jexcel.copyControls.enabled){if(!jexcel.current.edition){jexcel.current.copy(true)}}};jexcel.cutControls=function(e){if(jexcel.current){if(!jexcel.current.edition){jexcel.current.copy(true);if(jexcel.current.options.editable==true){jexcel.current.setValue(jexcel.current.highlighted,"")}}}};jexcel.pasteControls=function(e){if(jexcel.current&&jexcel.current.selectedCell){if(!jexcel.current.edition){if(jexcel.current.options.editable==true){if(e&&e.clipboardData){jexcel.current.paste(jexcel.current.selectedCell,e.clipboardData.getData("text"));e.preventDefault()}else{if(window.clipboardData){jexcel.current.paste(jexcel.current.selectedCell,e.clipboardData.getData("text"))}}}}}};jexcel.contextMenuControls=function(e){e=e||window.event;if("buttons" in e){var mouseButton=e.buttons}else{var mouseButton=e.which||e.button}if(jexcel.current){if(jexcel.current.edition){e.preventDefault()}else{if(jexcel.current.options.contextMenu){jexcel.current.contextMenu.contextmenu.close();if(jexcel.current){var x=e.target.getAttribute("data-x");var y=e.target.getAttribute("data-y");if(x||y){if((x<parseInt(jexcel.current.selectedCell[0]))||(x>parseInt(jexcel.current.selectedCell[2]))||(y<parseInt(jexcel.current.selectedCell[1]))||(y>parseInt(jexcel.current.selectedCell[3]))){jexcel.current.updateSelectionFromCoords(x,y,x,y)}var items=jexcel.current.options.contextMenu(jexcel.current,x,y,e);jexcel.current.contextMenu.contextmenu.open(e,items);e.preventDefault()}}}}}};jexcel.touchStartControls=function(e){var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]){if(jexcel.current!=jexcelTable[0].jexcel){if(jexcel.current){jexcel.current.resetSelection()}jexcel.current=jexcelTable[0].jexcel}}else{if(jexcel.current){jexcel.current.resetSelection();jexcel.current=null}}if(jexcel.current){if(!jexcel.current.edition){var columnId=e.target.getAttribute("data-x");var rowId=e.target.getAttribute("data-y");if(columnId&&rowId){jexcel.current.updateSelectionFromCoords(columnId,rowId);jexcel.timeControl=setTimeout(function(){if(jexcel.current.options.columns[columnId].type=="color"){jexcel.tmpElement=null}else{jexcel.tmpElement=e.target}jexcel.current.openEditor(e.target,false,e)},500)}}}};jexcel.touchEndControls=function(e){if(jexcel.timeControl){clearTimeout(jexcel.timeControl);jexcel.timeControl=null;if(jexcel.tmpElement&&jexcel.tmpElement.children[0].tagName=="INPUT"){jexcel.tmpElement.children[0].focus()}jexcel.tmpElement=null}};jexcel.tabs=function(tabs,result){var instances=[];if(!tabs.classList.contains("jexcel_tabs")){tabs.innerHTML="";tabs.classList.add("jexcel_tabs");tabs.jexcel=[];var div=document.createElement("div");var headers=tabs.appendChild(div);var div=document.createElement("div");var content=tabs.appendChild(div)}else{var headers=tabs.children[0];var content=tabs.children[1]}var spreadsheet=[];var link=[];for(var i=0;i<result.length;i++){spreadsheet[i]=document.createElement("div");spreadsheet[i].classList.add("jexcel_tab");var worksheet=jexcel(spreadsheet[i],result[i]);content.appendChild(spreadsheet[i]);instances[i]=tabs.jexcel.push(worksheet);link[i]=document.createElement("div");link[i].classList.add("jexcel_tab_link");link[i].setAttribute("data-spreadsheet",tabs.jexcel.length-1);link[i].innerHTML=result[i].sheetName;link[i].onclick=function(){for(var j=0;j<headers.children.length;j++){headers.children[j].classList.remove("selected");content.children[j].style.display="none"}var i=this.getAttribute("data-spreadsheet");content.children[i].style.display="block";headers.children[i].classList.add("selected")};headers.appendChild(link[i])}for(var j=0;j<headers.children.length;j++){headers.children[j].classList.remove("selected");content.children[j].style.display="none"}headers.children[headers.children.length-1].classList.add("selected");content.children[headers.children.length-1].style.display="block";return instances};jexcel.createTabs=jexcel.tabs;jexcel.fromSpreadsheet=function(file,__callback){var convert=function(workbook){var spreadsheets=[];workbook.SheetNames.forEach(function(sheetName){var spreadsheet={};spreadsheet.rows=[];spreadsheet.columns=[];spreadsheet.data=[];spreadsheet.style={};spreadsheet.sheetName=sheetName;var temp=workbook.Sheets[sheetName]["!cols"];if(temp&&temp.length){for(var i=0;i<temp.length;i++){spreadsheet.columns[i]={};if(temp[i]&&temp[i].wpx){spreadsheet.columns[i].width=temp[i].wpx+"px"}}}var temp=workbook.Sheets[sheetName]["!rows"];if(temp&&temp.length){for(var i=0;i<temp.length;i++){if(temp[i]&&temp[i].hpx){spreadsheet.rows[i]={};spreadsheet.rows[i].height=temp[i].hpx+"px"}}}var temp=workbook.Sheets[sheetName]["!merges"];if(temp&&temp.length>0){spreadsheet.mergeCells=[];for(var i=0;i<temp.length;i++){var x1=temp[i].s.c;var y1=temp[i].s.r;var x2=temp[i].e.c;var y2=temp[i].e.r;var key=jexcel.getColumnNameFromId([x1,y1]);spreadsheet.mergeCells[key]=[x2-x1+1,y2-y1+1]}}var max_x=0;var max_y=0;var temp=Object.keys(workbook.Sheets[sheetName]);for(var i=0;i<temp.length;i++){if(temp[i].substr(0,1)!="!"){var cell=workbook.Sheets[sheetName][temp[i]];var info=jexcel.getIdFromColumnName(temp[i],true);if(!spreadsheet.data[info[1]]){spreadsheet.data[info[1]]=[]}spreadsheet.data[info[1]][info[0]]=cell.f?"="+cell.f:cell.w;if(max_x<info[0]){max_x=info[0]}if(max_y<info[1]){max_y=info[1]}if(cell.style&&Object.keys(cell.style).length>0){spreadsheet.style[temp[i]]=cell.style}if(cell.s&&cell.s.fgColor){if(spreadsheet.style[temp[i]]){spreadsheet.style[temp[i]]+=";"}spreadsheet.style[temp[i]]+="background-color:#"+cell.s.fgColor.rgb}}}var numColumns=spreadsheet.columns;for(var j=0;j<=max_y;j++){for(var i=0;i<=max_x;i++){if(!spreadsheet.data[j]){spreadsheet.data[j]=[]}if(!spreadsheet.data[j][i]){if(numColumns<i){spreadsheet.data[j][i]=""}}}}spreadsheets.push(spreadsheet)});return spreadsheets};var oReq;oReq=new XMLHttpRequest();oReq.open("GET",file,true);if(typeof Uint8Array!=="undefined"){oReq.responseType="arraybuffer";oReq.onload=function(e){var arraybuffer=oReq.response;var data=new Uint8Array(arraybuffer);var wb=XLSX.read(data,{type:"array",cellFormula:true,cellStyles:true});__callback(convert(wb))}}else{oReq.setRequestHeader("Accept-Charset","x-user-defined");oReq.onreadystatechange=function(){if(oReq.readyState==4&&oReq.status==200){var ff=convertResponseBodyToText(oReq.responseBody);var wb=XLSX.read(ff,{type:"binary",cellFormula:true,cellStyles:true});__callback(convert(wb))}}}oReq.send()};jexcel.validLetter=function(text){var regex=/([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;return text.match(regex)?1:0};jexcel.injectArray=function(o,idx,arr){return o.slice(0,idx).concat(arr).concat(o.slice(idx))};jexcel.getColumnName=function(i){var letter="";if(i>701){letter+=String.fromCharCode(64+parseInt(i/676));letter+=String.fromCharCode(64+parseInt((i%676)/26))}else{if(i>25){letter+=String.fromCharCode(64+parseInt(i/26))}}letter+=String.fromCharCode(65+(i%26));return letter};jexcel.getIdFromColumnName=function(id,arr){var t=/^[a-zA-Z]+/.exec(id);if(t){var code=0;for(var i=0;i<t[0].length;i++){code+=parseInt(t[0].charCodeAt(i)-64)*Math.pow(26,(t[0].length-1-i))}code--;if(code<0){code=0}var number=parseInt(/[0-9]+$/.exec(id));if(number>0){number--}if(arr==true){id=[code,number]}else{id=code+"-"+number}}return id};jexcel.getColumnNameFromId=function(cellId){if(!Array.isArray(cellId)){cellId=cellId.split("-")}return jexcel.getColumnName(parseInt(cellId[0]))+(parseInt(cellId[1])+1)};jexcel.getElement=function(element){var jexcelSection=0;var jexcelElement=0;function path(element){if(element.className){if(element.classList.contains("jexcel_container")){jexcelElement=element}}if(element.tagName=="THEAD"){jexcelSection=1}else{if(element.tagName=="TBODY"){jexcelSection=2}}if(element.parentNode){if(!jexcelElement){path(element.parentNode)}}}path(element);return[jexcelElement,jexcelSection]};jexcel.doubleDigitFormat=function(v){v=""+v;if(v.length==1){v="0"+v}return v};jexcel.createFromTable=function(el,options){if(el.tagName!="TABLE"){console.log("Element is not a table")}else{if(!options){options={}}options.columns=[];options.data=[];var colgroup=el.querySelectorAll("colgroup > col");if(colgroup.length){for(var i=0;i<colgroup.length;i++){var width=colgroup[i].style.width;if(!width){var width=colgroup[i].getAttribute("width")}if(width){if(!options.columns[i]){options.columns[i]={}}options.columns[i].width=width}}}var parseHeader=function(header){var info=header.getBoundingClientRect();var width=info.width>50?info.width:50;if(!options.columns[i]){options.columns[i]={}}if(header.getAttribute("data-celltype")){options.columns[i].type=header.getAttribute("data-celltype")}else{options.columns[i].type="text"}options.columns[i].width=width+"px";options.columns[i].title=header.innerHTML;options.columns[i].align=header.style.textAlign||"center";if(info=header.getAttribute("name")){options.columns[i].name=info}if(info=header.getAttribute("id")){options.columns[i].id=info}};var nested=[];var headers=el.querySelectorAll(":scope > thead > tr");if(headers.length){for(var j=0;j<headers.length-1;j++){var cells=[];for(var i=0;i<headers[j].children.length;i++){var row={title:headers[j].children[i].innerText,colspan:headers[j].children[i].getAttribute("colspan")||1};cells.push(row)}nested.push(cells)}headers=headers[headers.length-1].children;for(var i=0;i<headers.length;i++){parseHeader(headers[i])}}var rowNumber=0;var mergeCells={};var rows={};var style={};var classes={};var content=el.querySelectorAll(":scope > tr, :scope > tbody > tr");for(var j=0;j<content.length;j++){options.data[rowNumber]=[];if(options.parseTableFirstRowAsHeader==true&&!headers.length&&j==0){for(var i=0;i<content[j].children.length;i++){parseHeader(content[j].children[i])}}else{for(var i=0;i<content[j].children.length;i++){var value=content[j].children[i].getAttribute("data-formula");if(value){if(value.substr(0,1)!="="){value="="+value}}else{var value=content[j].children[i].innerHTML}options.data[rowNumber].push(value);var cellName=jexcel.getColumnNameFromId([i,j]);var tmp=content[j].children[i].getAttribute("class");if(tmp){classes[cellName]=tmp}var mergedColspan=parseInt(content[j].children[i].getAttribute("colspan"))||0;var mergedRowspan=parseInt(content[j].children[i].getAttribute("rowspan"))||0;if(mergedColspan||mergedRowspan){mergeCells[cellName]=[mergedColspan||1,mergedRowspan||1]}if(s=content[j].children[i].style&&content[j].children[i].style.display=="none"){content[j].children[i].style.display=""}var s=content[j].children[i].getAttribute("style");if(s){style[cellName]=s}if(content[j].children[i].classList.contains("styleBold")){if(style[cellName]){style[cellName]+="; font-weight:bold;"}else{style[cellName]="font-weight:bold;"}}}if(content[j].style&&content[j].style.height){rows[j]={height:content[j].style.height}}rowNumber++}}if(Object.keys(nested).length>0){options.nestedHeaders=nested}if(Object.keys(style).length>0){options.style=style}if(Object.keys(mergeCells).length>0){options.mergeCells=mergeCells}if(Object.keys(rows).length>0){options.rows=rows}if(Object.keys(classes).length>0){options.classes=classes}var content=el.querySelectorAll("tfoot tr");if(content.length){var footers=[];for(var j=0;j<content.length;j++){var footer=[];for(var i=0;i<content[j].children.length;i++){footer.push(content[j].children[i].innerText)}footers.push(footer)}if(Object.keys(footers).length>0){options.footers=footers}}if(options.parseTableAutoCellType==true){var pattern=[];for(var i=0;i<options.columns.length;i++){var test=true;var testCalendar=true;pattern[i]=[];for(var j=0;j<options.data.length;j++){var value=options.data[j][i];if(!pattern[i][value]){pattern[i][value]=0}pattern[i][value]++;if(value.length>25){test=false}if(value.length==10){if(!(value.substr(4,1)=="-"&&value.substr(7,1)=="-")){testCalendar=false}}else{testCalendar=false}}var keys=Object.keys(pattern[i]).length;if(testCalendar){options.columns[i].type="calendar"}else{if(test==true&&keys>1&&keys<=parseInt(options.data.length*0.1)){options.columns[i].type="dropdown";options.columns[i].source=Object.keys(pattern[i])}}}}return options}};if(typeof(jQuery)!="undefined"){(function($){$.fn.jspreadsheet=$.fn.jexcel=function(mixed){var spreadsheetContainer=$(this).get(0);if(!spreadsheetContainer.jexcel){return jexcel($(this).get(0),arguments[0])}else{if(Array.isArray(spreadsheetContainer.jexcel)){return spreadsheetContainer.jexcel[mixed][arguments[1]].apply(this,Array.prototype.slice.call(arguments,2))}else{return spreadsheetContainer.jexcel[mixed].apply(this,Array.prototype.slice.call(arguments,1))}}}})(jQuery)}return jexcel})));